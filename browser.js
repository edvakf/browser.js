// WBkB0vp5PNSfe+GludsyQdUt+42+iVuQOe3hJO8t1KdHs12w58mfcNlUS0rhQ43z24sweiRMpuuZVFit/RUcLHFVGfC1Je7zeP13Q7n+hzBghi4ZbKQBIdY8Y000WE6pXvsMEGJNRVwFBlTCQWsWYrohvNnmbaWRG86xHYH9MvD7NS85qVXcHRcSR3nFgigZf8VLTyWh3k6CHjIJj4s5ZR7h1snlShnWRxfOT/EoGM8XPzLB4pZLWlbYvw4/g/XZbtd2Os8+YvVpSZXwsFxG7B6o8CGNQltip02wtRdj9ED+8CrapWWDrYSgF+C3rW1fZMJpu+JYXLSlft+aOM3irg==
/**
** Copyright (C) 2000-2008 Opera Software AS.  All rights reserved.
**
** This file is part of the Opera web browser.
**
** This script patches sites to work better with Opera
** For more information see http://www.opera.com/docs/browserjs/
**
** If you have comments on these patches (for example if you are the webmaster
** and want to inform us about a fixed site that no longer needs patching) please
** report issues through the bug tracking system
** https://bugs.opera.com/
**
** DO NOT EDIT THIS FILE! It will not be used by Opera if edited.
**/
// Generic fixes (mostly)
(function(opera){
	var bjsversion=' Opera  9.50, November 14, 2008 ';
	// variables and utility functions
	var navRestore = {}; // keep original navigator.* values
	var shouldRestore = false;
	var hostname = location.hostname; // caching some strings for performance
	var href = location.href;
	var pathname=location.pathname;
	var fixed = false; // magic fixes need only run once
	if(!opera.postError)opera.postError=function(){}; // handling versions w/o error console
	// Storing function references
	var postError = opera.postError,
	call = Function.prototype.call,
	indexOf=String.prototype.indexOf,
	lastIndexOf=String.prototype.lastIndexOf,
	replace=String.prototype.replace,
	match=String.prototype.match,
	toLowerCase=String.prototype.toLowerCase,
	getAttribute=Element.prototype.getAttribute,
	setAttribute=Element.prototype.setAttribute,
	insertBefore=Node.prototype.insertBefore,
	insertAdjacentHTML=Element.prototype.insertAdjacentHTML,
	defineMagicVariable=opera.defineMagicVariable,
	defineMagicFunction=opera.defineMagicFunction,
	version=opera.version,
	getElementById=Document.prototype.getElementById,
	appendChild=Node.prototype.appendChild,
	removeChild=Node.prototype.removeChild,
	replaceChild=Node.prototype.replaceChild,
	evaluate=Document.prototype.evaluate,
	getElementsByTagName=Document.prototype.getElementsByTagName,
	createElement=Document.prototype.createElement,
	createTextNode=Document.prototype.createTextNode,
	stopPropagation=Event.prototype.stopPropagation,
	preventDefault=Event.prototype.preventDefault,
	getComputedStyle=window.getComputedStyle,
	slice=Array.prototype.slice,
	shift=Array.prototype.shift,
	setTimeout=window.setTimeout,
	removeAttribute=Element.prototype.removeAttribute,
	addEventListener=Document.prototype.addEventListener,
	isNaN=window.isNaN,
	RegExp=window.RegExp,
	unescape=window.unescape,
	func_toString=Function.prototype.toString,
	parseFloat=window.parseFloat;
	var opera_version = parseFloat.call(window,opera.version());

	// Utility functions
	function addCssToDocument(cssText, doc, mediaType){
		getElementsByTagName.call=addEventListener.call=createElement.call=createTextNode.call=insertBefore.call=setAttribute.call=appendChild.call=version.call=call;
		doc = doc||document;
		mediaType = mediaType||'';
		addCssToDocument.styleObj=addCssToDocument.styleObj||{};
		var styles = addCssToDocument.styleObj[mediaType];
		if(!styles){
			var head = getElementsByTagName.call(doc, "head")[0];
			if( !head ){
				var docEl = getElementsByTagName.call(doc, "html")[0];
				if(!docEl){
					// :S this shouldn't happen - see if document hasn't loaded
					addEventListener.call(doc, opera&&version.call(opera)>=9?'DOMContentLoaded':'load',
					function(){ addCssToDocument(cssText, doc); },false);
					return;
				}
				head = createElement.call(doc, "head");
				if(head) insertBefore.call(docEl, head,docEl.firstChild);
				else head = docEl;
			}
			addCssToDocument.styleObj[mediaType] = styles = createElement.call(doc, "style");
			setAttribute.call(styles, "type","text/css");
			if(mediaType)setAttribute.call(styles, "media", mediaType);
			appendChild.call(styles, createTextNode.call(doc,' '));
			appendChild.call(head, styles)
		}
		styles.firstChild.nodeValue += cssText+"\n";
		return true;
	}
	function addPreprocessHandler( search, replacement, onceonly, conditional ){
		// adding event handler for script pre-processing if required
		opera.addEventListener('BeforeScript', 
			function(e){ 
				indexOf.call=replace.call=removeEventListener.call=call; /* also needs anything used inside conditional! */
				if( conditional && ! conditional(e.element) ){return;}
				e.element.text=replace.call( e.element.text, search, replacement );
				if(onceonly){
					removeEventListener.call(opera, 'BeforeScript', arguments.callee, false);
				}
			}
		, false);
	}
function avoidDocumentWriteAbuse(){
	var dw=document.write;
	document.write=function( s ){
		if( String(s).match( /(^<img .*?width=("|)1("|) height=("|)1("|) border=("|)0("|) alt="">$|^\[object Object\]$)/i ) ){
			opera.postError('Warning: scripts on '+window.location+' were changed by the s_code patch. See browser.js for details.');
		}else{
			dw.apply(document, arguments);
		}
	};
}
function emulateIECapturingEvents(){
	// An implementation of IE5 mouse event capturing
	var capturingEventsTable =
			{'mousedown':'',
			'mouseup':'',
			'mousemove':'',
			'click':'',
			'dblclick':'',
			'mouseover':'',
			'mouseout':'',
			'contextmenu':''};
	var loseCaptureEventsTable =
			{'contextmenu':''};
	var capturingEl = null;
	var capturingContainer;
	var cachedSelection;
	var cachedSelectionCollapsed;
	var loseCaptureEl;

	HTMLElement.prototype.setCapture = function(isCapturingContainer) {
		if (capturingEl && capturingEl != this) {
			capturingEl.releaseCapture();
		}
		capturingEl = this;
		var sel = window.getSelection();
		cachedSelection = sel.rangeCount?sel.getRangeAt(0):null;
		cachedSelectionCollapsed = !(cachedSelection && !cachedSelection.collapsed);
		loseCaptureEl = null;
		capturingContainer = (isCapturingContainer !== false); // defaults to true
	};

	HTMLElement.prototype.releaseCapture = function() {
		if (capturingEl != this) return;
		capturingEl = null;
		if (cachedSelection) {
			var sel = window.getSelection();
			sel.removeAllRanges();
			sel.addRange(cachedSelection);
			cachedSelection = null;
		} else {
			document.execCommand('unselect', null, true);
		}

		var loseCaptureEvent;
		try {
			loseCaptureEvent = document.createEvent('CustomEvent'); // DOM 3
		} catch(e) {
			loseCaptureEvent = document.createEvent('Event');
		}
		loseCaptureEvent.initEvent(
				'losecapture', // type
				false,         // bubbles
				false          // cancellable
		);
		this.dispatchEvent(loseCaptureEvent);
	};

	document.releaseCapture = function() {
		if (!capturingEl) return;
		capturingEl.releaseCapture();
	};
	var ignoreEvent;
	var mouseDownEl;
	function capturingListener(evt) {
		if (!capturingEl) return;
		if (ignoreEvent == evt) return;
		if (parseFloat(opera.version(), 10) >= 9.5 && evt.type != 'mousemove' && evt.type != 'mouseout') {
			document.execCommand('unselect', null, true);
		}
		if (mouseDownEl && evt.type == 'click' && mouseDownEl.contains(evt.target)) {
			mouseDownEl = null;
			evt.stopPropagation();
			evt.preventDefault();
			return;
		}
		var currentCapturingEl = capturingEl;
		var originalEvent = evt;
		var originalTarget = originalEvent.target;
		if (typeof(loseCaptureEventsTable[originalEvent.type])!='undefined') {
			loseCaptureEl = currentCapturingEl;
		}
		if (!capturingContainer &&
				originalTarget != currentCapturingEl &&
				currentCapturingEl.contains(originalTarget))
		{
			return;
		}
		var fakeEvent = document.createEvent('MouseEvent');
		fakeEvent.initMouseEvent(
				originalEvent.type,
				originalEvent.bubbles,
				originalEvent.cancelable,
				window,
				originalEvent.detail,
				originalEvent.screenX,
				originalEvent.screenY,
				originalEvent.clientX,
				originalEvent.clientY,
				originalEvent.ctrlKey,
				originalEvent.altKey,
				originalEvent.shiftKey,
				originalEvent.metaKey,
				originalEvent.button,
				originalEvent.relatedTarget
		);
		ignoreEvent = fakeEvent;
		if (fakeEvent.__defineGetter__) fakeEvent.__defineGetter__('srcElement', function() {
			return originalTarget;
		});
		var retVal = currentCapturingEl.dispatchEvent(fakeEvent);
		if (currentCapturingEl != loseCaptureEl) {
			originalEvent.stopPropagation();
			if (!retVal) {
				originalEvent.preventDefault();
			}
		}

		if (originalEvent.type == 'mousedown') {
			mouseDownEl = originalTarget;
		} else if (originalEvent.type == 'mouseup') {
			if (!currentCapturingEl.contains(originalTarget) || currentCapturingEl.contains(mouseDownEl) ||
					(mouseDownEl && !mouseDownEl.contains(originalTarget))) {
				fakeEvent = document.createEvent('MouseEvent');
				fakeEvent.initMouseEvent(
						'click',
						originalEvent.bubbles,
						originalEvent.cancelable,
						window,
						originalEvent.detail,
						originalEvent.screenX,
						originalEvent.screenY,
						originalEvent.clientX,
						originalEvent.clientY,
						originalEvent.ctrlKey,
						originalEvent.altKey,
						originalEvent.shiftKey,
						originalEvent.metaKey,
						originalEvent.button,
						originalEvent.relatedTarget
				);
				if (fakeEvent.__defineGetter__) fakeEvent.__defineGetter__('srcElement', function() {
					return originalTarget;
				});
				ignoreEvent = fakeEvent;
				currentCapturingEl.dispatchEvent(fakeEvent);
			}
			if (!currentCapturingEl.contains(mouseDownEl)) {
				mouseDownEl = null;
			}
		}
		ignoreEvent = null;
	}
	var loseCaptureAfterEvent = function(evt) {
		if (!loseCaptureEl) return;
		loseCaptureEl.releaseCapture();
		loseCaptureEl = null;
	};

	for(var event in capturingEventsTable ){
		window.addEventListener(event, capturingListener, true);
	}
	for(var event in loseCaptureEventsTable ){
		window.addEventListener(event, loseCaptureAfterEvent, false);
	}

	document.selection.empty = function() {
		if (!capturingEl) return document.execCommand('unselect', null, true);
		cachedSelection = null;
	};
	var getCommonAncestor = function(a, b) {
		var range = document.createRange();
		try {
			range.setStart(a, 0);
			range.setEnd(b, 0);
			return range.commonAncestorContainer;
		} catch(e) {
			return document;
		}
	};
	window.addEventListener('mouseover', function(originalEvent) {
		if (capturingEl) return;
		var fakeEvent = document.createEvent('MouseEvent');
		fakeEvent.initMouseEvent(
			'mouseenter',
			originalEvent.bubbles,
			originalEvent.cancelable,
			window,
			originalEvent.detail,
			originalEvent.screenX,
			originalEvent.screenY,
			originalEvent.clientX,
			originalEvent.clientY,
			originalEvent.ctrlKey,
			originalEvent.altKey,
			originalEvent.shiftKey,
			originalEvent.metaKey,
			originalEvent.button,
			originalEvent.relatedTarget
		);
		var commonAncestor = getCommonAncestor(originalEvent.target, originalEvent.relatedTarget);
		var listener = function(evt) {
			if (evt == fakeEvent) {
				commonAncestor.removeEventListener('mouseenter', arguments.callee, false);
				evt.stopPropagation();
			}
		};
		commonAncestor.addEventListener('mouseenter', listener, false);
		originalEvent.target.dispatchEvent(fakeEvent);
		commonAncestor.removeEventListener('mouseenter', listener, false);
	}, false);
	window.addEventListener('mouseout', function(originalEvent) {
		if (capturingEl) return;
		var fakeEvent = document.createEvent('MouseEvent');
		fakeEvent.initMouseEvent(
			'mouseleave',
			originalEvent.bubbles,
			originalEvent.cancelable,
			window,
			originalEvent.detail,
			originalEvent.screenX,
			originalEvent.screenY,
			originalEvent.clientX,
			originalEvent.clientY,
			originalEvent.ctrlKey,
			originalEvent.altKey,
			originalEvent.shiftKey,
			originalEvent.metaKey,
			originalEvent.button,
			originalEvent.relatedTarget
		);
		var commonAncestor = getCommonAncestor(originalEvent.target, originalEvent.relatedTarget);
		var listener = function(evt) {
			if (evt == fakeEvent) {
				commonAncestor.removeEventListener('mouseleave', arguments.callee, false);
				evt.stopPropagation();
			}
		};
		commonAncestor.addEventListener('mouseleave', listener, false);
		originalEvent.target.dispatchEvent(fakeEvent);
		commonAncestor.removeEventListener('mouseleave', listener, false);
	}, false);
}	function fakeCSSFilters(){ // faking support for some of the common filters so that using them won't stop the script
		var filterObj={apply:function(){}, play:function(){}, Apply:function(){}, Play:function(){}}; // some of the common functions
		HTMLElement.prototype.filters=[ filterObj, filterObj, filterObj ]; // fake three applied filters with play and apply functions
		HTMLElement.prototype.filters['blendTrans']=filterObj; // we also fake a named blendTrans filter
	}
function fakeOncontextmenu( useAltClick, clickAndHold ){

	if ( 'oncontextmenu' in document.createElement('foo') )
		//contextmenu supported - nothing to do
		return;
		
	function cloneObject(src,dest){
		dest=dest||{};
		for(var prop in src)
			dest[prop]=src[prop];
		return dest;
	};
	function prepareContextMenuEvent(e,node){
		var ev = cloneObject(e);
		ev.currentTarget=node;
		ev.type='contextmenu';
		ev.returnValue=true;
		ev.cancelBubble=false;
		ev.preventDefault=function(ev){this.returnValue=false;}
		ev.stopPropagation=function(ev){this.cancelBubble=false;}
		return ev;
	}
	function ctxClickHandler(e){
		var node = e.target, foundAnything = false;
		do{
			if( typeof node.oncontextmenu == 'function' ){
				var ev = prepareContextMenuEvent(e,node)
				try{
					node.oncontextmenu(ev);
					if(!ev.returnValue)
						e.preventDefault();
					if(ev.cancelBubble){
						e.stopPropagation();
						return true;
					}
				}catch(ex){
					setTimeout(function(){throw ex;},1);
				}
				foundAnything = true;
			}else if( node.getAttribute && (js = node.getAttribute('oncontextmenu')) ){
				var ev = prepareContextMenuEvent(e,node)
				try{
					var retVal = eval('(function(){'+js+';}).call(node,ev);')||ev.returnValue ;
					if(!retVal && (retVal!==undefined))
						e.preventDefault();
					if(ev.cancelBubble){
						e.stopPropagation();
						return true;
					}
				}catch(ex){
					setTimeout(function(){throw ex;},1);
				}
				foundAnything = true;
			}
		}while(node=node.parentNode);
		return foundAnything;
	}
	function dispatchCtxMenuEvent(e){
		var doc = e.target.ownerDocument||(e.view?e.view.document:null)||e.target;
		var newEv = doc.createEvent('MouseEvent');
		newEv.initMouseEvent('contextmenu', true, true, doc.defaultView, e.detail,
			e.screenX, e.screenY, e.clientX, e.clientY, e.ctrlKey, e.altKey,
			e.shiftKey, e.metaKey, 2, e.relatedTarget);
		e.target.dispatchEvent(newEv);
	};
	
	var isRightClick = false;
	addEventListener('mousedown',function(e){
		if( e && e.button == 2 ){
			isRightClick = true;
			setTimeout(function(){isRightClick=false;},1000);
		}
	},true);
	addEventListener('mouseup',function(e){
		//right-click doesn't fire click event. Only mouseup
		if( e && e.button == 2 && isRightClick){
			dispatchCtxMenuEvent(e);
		}
		clearCtxTimeout();
	},true);
	addEventListener('contextmenu',function(e){
		ctxClickHandler(e);
	},true);
	if(useAltClick)
		addEventListener('click',function(e){
			if( e && e.button == 0 && e.altKey ){
				dispatchCtxMenuEvent(e);
			}
		},true);

			
	var eventCopy, ctxMenuTimeout;
	var pixelThreshold = 3;
	var msecCtxValue = clickAndHold;
	
	function clearCtxTimeout(){
		clearTimeout(ctxMenuTimeout);
		ctxMenuTimeout = eventCopy = null;
	}
	
	if( clickAndHold && typeof clickAndHold == 'number' ){
		addEventListener('mousedown',function(e){
			if(e && e.button!=2){
				eventCopy = cloneObject(e);
				eventCopy.preventDefault = function(){};
				eventCopy.stopPropagation = function(){};
				ctxMenuTimeout = setTimeout(function(){if(eventCopy)dispatchCtxMenuEvent(eventCopy);},msecCtxValue);
			}
		},true);
		
		addEventListener('mousemove',function(e){
			if( ctxMenuTimeout && eventCopy && e )
				if( Math.abs(e.clientX-eventCopy.clientX) > pixelThreshold ||
					Math.abs(e.clientY-eventCopy.clientY) > pixelThreshold ){
					clearCtxTimeout();
				}
		},true);
	}
	
};
	function fixCoolmenus(name){
		if(fixed){return;}fixed=true;
		defineMagicVariable.call=call;
		// Version 4 is Opera 7 - compatible and does user agent sniffing
		navRestore['userAgent'] = navigator.userAgent;
		navigator.userAgent +=' msie 6';
		shouldRestore = true;
		defineMagicVariable.call(opera, 'bw', function(o){
			// we need to override yet some more browser detection, and disable CSS filters
			// usedom must be 0 to make frameset menus work
			o.filter=o.op7=o.op=o.usedom=o.ns6=0;
			o.ie=o.ie6=1;
			return o}, function(o){return o});
		addPreprocessHandler(  'this.win.document.body.appendChild(oNS)',  'try{this.win.document.body.appendChild(oNS)}catch(e){oNS=this.win.document.body.appendChild(this.win.document.importNode(oNS, true))}' );
		addPreprocessHandler(  'oNS.appendChild(oNS2)',  'try{oNS.appendChild(oNS2);}catch(e){oNS2=oNS.appendChild(oNS.document.importNode(oNS2, true));}' );
	}
	function fixHVMenu(name){
		if(fixed){return;}fixed=true;
		defineMagicVariable.call=match.call=call;
		// fix by changing Opera from an unsupported browser to a supported browser
		// Set to true either PosStrt, NavYes, DomNav   or   PosStrt, ExpYes, DomExp
		defineMagicVariable.call(opera, 'PosStrt', function(){ return true }, null);
		defineMagicVariable.call(opera, 'NavYes', function(){ return true }, null);
		defineMagicVariable.call(opera, 'DomNav', function(){ return true }, null);
		// if Opera >= 9.5, load events are sent to document and not to body - make sure script doesn't set body.onload
		defineMagicVariable.call(opera, 'Trigger', function(){ return document; }, null);
		// Tell the script that CSS filters are not supported.
		defineMagicVariable.call(opera, 'Fltr', function(){ return false; }, function(){ return });
		// More recent versions look for 'opera 7' in navigator.userAgent and some do not use the variable names above
		if(  match.call(name, /var\.js$/) || match.call(name, /compact\.js$/) ){
			navRestore['userAgent'] = navigator.userAgent;
			navigator.userAgent+=' opera 7'; 
			shouldRestore = true;
		}
	}	function fixHierMenus(){
		if(fixed){return;}fixed=true;
		defineMagicVariable.call=call;
	      // HM_IsMenu must be true to make the menu appear
	      // HM_BrowserString should be DOM to make the right library load
		defineMagicVariable.call(opera, 'HM_IsMenu', function(){ return true}, function(){ return true });
		if(!document.all)defineMagicVariable.call(opera, 'HM_IE', function(){ return true}, function(){ return true });
		defineMagicVariable.call(opera, 'HM_BrowserString', function(){ return 'DOM'}, function(){ return 'DOM' });
	}
function fixIFrameSSIscriptII(name, iFrameId){
	if(name)opera.defineMagicFunction(name, function (a,b,frameid){
		frameid = frameid|| iFrameId;
		var currentfr=document.getElementById(frameid);
		if (currentfr){
			currentfr.height = currentfr.contentDocument.documentElement.scrollHeight;
			if(!arguments.callee._listenerAdded){
				currentfr.addEventListener("load", arguments.callee, false);
				arguments.callee._listenerAdded=true;
			}
		}
	});
}function fixJQueryScriptSchedulingTrouble(){
	var scriptQueue = [];
	Element.prototype.appendChild = (function(ac){
		return function(child, fromQueue){
			if( ! fromQueue && child instanceof HTMLScriptElement && child.src){
					scriptQueue.push({child: child, parent: this});
					return child;
			}else
				return ac.call(this, child);
		}
	})(Element.prototype.appendChild)

	opera.addEventListener('AfterScript', function(e){
		removeChild.call = replaceChild.call = appendChild.call = shift.call = call;
		if(e.element.__operaRemovalFlag){
			removeChild.call(e.element.parentNode, e.element);
		}
		if( scriptQueue.length ){
			var script = shift.call(scriptQueue);
			if( script.replaceEl ){
				replaceChild.call( script.parent, script.child, script.replaceEl, true );
			}else{
				appendChild.call( script.parent, script.child, true );
			}
		}
	}, false);

	Element.prototype.removeChild = (function( rc ){
		return function( child ){
			if(child instanceof HTMLScriptElement && child.src && child.readyState != 'loaded' ){
				child.__operaRemovalFlag=true;
				return child;
			}else
				return rc.call(this, child);
		}
	})(Element.prototype.removeChild);

	// This fixes Sarissa too..
	Element.prototype.replaceChild = (function(ac){
		return function( child, existing, fromQueue ){
			if( ! fromQueue && child instanceof HTMLScriptElement ){
					scriptQueue.push({child: child, parent: this, replaceEl: existing });
					return existing;
			}else
				return ac.call(this, child, existing);
		}
	})(Element.prototype.replaceChild)
}function fixLiknoAllWebMenus(ev){
	indexOf.call=match.call=defineMagicVariable.call=postError.call=removeEventListener.call=appendChild.call=createElement.call=preventDefault.call=replace.call=call;
	if(fixed)return; fixed=true;
	if( indexOf.call(ev.element.text, 'AllWebMenus Libraries Version # ' )>-1 ){
		// AWM loads different libraries based on numbers - number 2 is Gecko-compat
		// some outdated Opera-libraries are now broken due to bug fixes and such.
		var awmVersion = parseInt(match.call(ev.element.text, /AllWebMenus Libraries Version # (\d*)/)[1]);
		if( awmVersion <=496  ){ // likely to old to work..
			defineMagicVariable.call(opera,   'scriptNo', function(){return 2}, null);
			defineMagicVariable.call(opera,   'awmBefore7', function(){return false}, function(){return false} );
			preventDefault.call(ev); // don't run this script
			var script = appendChild.call(document.body, createElement.call(document, 'script')); // create another one..
			script.src = replace.call(ev.element.src, /awmlib\d*\.js/, 'awmlib2.js'); // and load a more suitable version
			postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (AllWebMenus fix). See browser.js for details.');
		}
		removeEventListener.call(opera, 'BeforeScript', arguments.callee, false );
	}
}	function fixMilonicMenu(name){ 	// gotcha: must be called with script.src as argument
		if(fixed){return;}fixed=true;
		defineMagicVariable.call=defineMagicFunction.call=addEventListener.call=call;
	      // "opera" or "opra" true will cause no menu or garbled (Opera 6 pixel* -  compat)
		defineMagicVariable.call(opera, 'opera', function(){ return false }, function(){});
		defineMagicVariable.call(opera, 'opra', function(){ return false }, function(){});
		// ie55 true will use IFRAME shims
		defineMagicVariable.call(opera, 'ie55', function(){ return false }, function(){ });
		// identifying as Opera will cause "dom" variable to be false in some versions
		defineMagicVariable.call(opera,  'dom' , function(){ return true }, function(){});
		// fixForm function will hide page content
		defineMagicFunction.call(opera,  'fixForm' , function(){});
		// Menu does not work on Mac if it detects platform
		defineMagicVariable.call(opera, 'mac', function(){ return false }, function(){ });
		// bug 330958
		if(window.__defineGetter__){
			window.__defineGetter__('scrollY', function(){ return document.body.scrollTop });
			window.__defineGetter__('scrollX', function(){ return document.body.scrollLeft });
		}
	}
function fixOpenCube(name){// IMPORTANT gotcha: the fixOpenCube and fixHVMenu functions must be called with an appropriate string argument
	match.call=addEventListener.call=defineMagicVariable.call=indexOf.call=call;
	// OpenCube menu
	window.vxml = window.vxml||{}; // to fix semi-opera-detection
	//Some versions try to call a function q99 which is only defined in the Opera library
	addEventListener.call(document, 'load', function(){ if(typeof q99=='undefined')window.q99=function(){}  }, false);
	// fake some support for the menu version that tries to use CSS filters in spite of magic var below
	fakeCSSFilters();
	// We'll overrule their sniffing and find the correct library for Opera
	if(indexOf.call(navigator.appVersion, 'Mac')!=-1){
		// They don't seem to like Macs.. see 356184
		navigator.appVersion = replace.call( navigator.appVersion, 'Mac', 'M A C' );
		addEventListener.call(opera, 'AfterExternalScript', function(){
			replace.call = removeEventListener.call = call;
			navigator.appVersion = replace.call( navigator.appVersion, 'M A C', 'Mac' );
			removeEventListener.call(opera, 'AfterExternalScript', arguments.callee, false);
		}, false);
		// some variables are uninitialized
		q20=q21=[];
	}
	if(match.call(name, /dqm_script\d*\.js$/)){
		defineMagicVariable.call(opera, 'brn', function(val){ return 'ie' }, function(val){ return 'ie' });
		defineMagicVariable.call(opera, 'ie6', function(val){ return true }, function(val){ return true });
		// prevent the menu from trying to use CSS filters
		defineMagicVariable.call(opera, 'DQM_sub_menu_effect',  function(){return 'none';}, null);
		if(document.evaluate){ // we have an event transparency problem on some sites, see for example bug 239622
			addEventListener.call(document, 'load', function(){
				var nodes=document.evaluate( '//a/child::img[substring(@id, 0, 4)=\'qmim\']', document.body,null,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null ),node;
				while( node=nodes.iterateNext()){
					node.parentElement.parentElement.replaceChild(node, node.parentElement );
				};
			}, false);
		}
		fixed=true;
		return true;
	}else if(indexOf.call(name, 'dqm_loader.js')>-1){
		defineMagicVariable.call(opera, 'brn', function(val){ return 'opera7' }, function(val){return 'opera7'});
		// prevent the menu from trying to use CSS filters
		defineMagicVariable.call(opera, 'DQM_sub_menu_effect',  function(){return 'none';}, null);
		fixed=true;
		return true;
	}else if(indexOf.call(name, 'dnm_script.js')>-1){ // very old version.. 153257
		defineMagicVariable.call(opera, 'ie5', function(val){ return true }, function(val){ return true });
		defineMagicVariable.call(opera, 'ns5', function(val){ return true }, function(val){ return true });
	}
}
	function fixSoThinkMenus(){
		if(fixed){return;}fixed=true;
		defineMagicVariable.call=call;
		defineMagicVariable.call(opera, 'nOP',function(){return false;},null);
		defineMagicVariable.call(opera, 'nIE',function(){return false;},null);
		defineMagicVariable.call(opera, 'nNN6',function(){return true;},null);
	}
	function fixTransmenus(){
		// Fixing bugs in menu script from http://www.youngpup.net/2004/transmenus/ 
		// Credits xErath and Andrew Gregory
		opera.addEventListener('BeforeScript', function(ev) {
			indexOf.call=replace.call=removeEventListener.call=call;
			var js = ev.element.text;
			if (indexOf.call(js, "TransMenu")!=-1) {
				js = replace.call(js, /return\s+r(\b)/,"return true$1");
				js = replace.call(js, /mac/g,"xpto");
				js = replace.call(js, "el.scrollLeft", "0");
				js = replace.call(js, "el.scrollTop", "0");
				ev.element.text = js;
				removeEventListener.call(opera, 'BeforeScript', arguments.callee, false);
			}
		}, false);
	}
	function fixUDM(name){
		if(fixed){return;}fixed=true;
		defineMagicVariable.call=call;
		// Some versions are Opera 7 - compatible and do user agent sniffing
		navRestore['userAgent'] = navigator.userAgent;
		navigator.userAgent +=' opera 7.5';
		shouldRestore = true;
		// If the menu is a 3.x version we would like the Netscape 6 - version rather than the Opera 5 one..
		defineMagicVariable.call(opera, 'op5',function () { return 0; },null);
		defineMagicVariable.call(opera, 'ns6',function () { return 1; },null);
	}
function ignoreRequiredAttributes(){
	document.addEventListener('invalid', function(e){
		if( e.target.validity.valueMissing){
			e.target.removeAttribute('required');
			e.preventDefault();
			opera.postError('Warning: overriding built-in "required" attribute validation on page. See browser.js for details.');
		}
	},true);
}	function preventEventCapture(object,eventName){ // Opera supports capturing events but many sites do it by mistake
		var ael=object.addEventListener;
		object.addEventListener=function(type, func, cap){
			if(type==eventName)cap=false;
			ael.call( this, type, func, cap);
		}
	}
function removeClosingHTMLComments(){
    opera.addEventListener( 'BeforeScript', function(e){ replace.call=call; e.element.text=replace.call( e.element.text, /\r\n\s*-->\s*\r\n/, '' ); }, false );
}
function scriptForEventFix(){ // neutralising IE's <script for.. event.. > syntax
	opera.addEventListener('BeforeScript', 
		function(ev){
			getAttribute.call=setAttribute.call=preventDefault.call=call;
			if(getAttribute.call(ev.element, 'event')){
				setAttribute.call(ev.element, 'declare', 'declare');
				preventDefault.call(ev);
			}
		}
	, false);
}
function workAroundBug343019(){
	document.addEventListener('DOMContentLoaded', function(){
		for( var frms=document.getElementsByTagName('form'),i=0,frm; frm=frms[i];i++ ){
			if(!frm.action)return;
			if(/^javascript:/i.test(frm.action))return;
			var actionSubstring = /^http/i.test( frm.action ) ? frm.action.substr(7) : frm.action ;
			if( /(:)/.test(actionSubstring) ){
				var colonPosition = actionSubstring.indexOf(':')+1
				actionSubstring = actionSubstring.substr( colonPosition );
				frm.action = frm.action.substr(0, colonPosition) + (actionSubstring.replace(/\+/g, '%252B' ).replace( /\//g, '%252F' ));
			}
		}

	},false);
}

	// The required attribute does not take the value false according to WebForms2 - remove "required=false" from form elements
// Generic JS library patches
// Allow scripts to define reserved word top, but not not allow javascript: URLs to read the custom value
// Compatibility layer for Google Gears initialization script
// PDF security patch
// document.domain can not be set to last TLD
			// 305669, The required attribute does not take the value false according to WebForms2 - remove "required=false" from form elements
	document.addEventListener('load', function(){
		try{var obj = document.evaluate( '//input[translate(@required, "FALSE", "false")="false"]', document.documentElement, null, 4, null ), el ;
		while(el=obj.iterateNext()){el.removeAttribute('required');}}catch(e){}
	}, false);
	
			// 0, Generic JS library patches
	// Use an event listener to detect specific scripts
	opera.addEventListener( 'BeforeExternalScript', function(ev){
		match.call=replace.call=indexOf.call=toLowerCase.call=postError.call=addEventListener.call=removeEventListener.call=version.call=parseFloat.call=call;
		
		var name=ev.element.src; 
		if( !name ){ return; } // no fixes required for SCRIPT xlink:href so far..
		name=toLowerCase.call(name );// toLowerCase fixes sangjatten.se
	      if ( indexOf.call(name, 'dqm_')>-1 || indexOf.call(name, 'dnm_')>-1 || indexOf.call(name, 'cbrowser_opera.js')>-1 ){ 
			// OpenCube menu
			if(fixOpenCube(name)){
				postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (OpenCube fix). See browser.js for details.');
			}
			return;
	      }else if(  indexOf.call(name, 'hm_loader')>-1  ){ 
			// HierMenus menu
			// If we apply this fix to version 6.x the menu breaks.
			// HM support recommends checking that HM_BrowserVersion is not defined
			addEventListener.call(opera, 'BeforeScript', function(ev){ 
				match.call=removeEventListener.call=postError.call=call;
				if( ev.element.text && ! match.call(ev.element.text, /hm_browserversion/i) ){
					fixHierMenus(name);
					postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (HierMenus fix). See browser.js for details.');
				}
				removeEventListener.call(opera, 'BeforeScript', arguments.callee, false);
			}, false);
			return;
	      }else if(  indexOf.call(name, 'mmenu')>-1 || indexOf.call(name, 'milonic')>-1  ){ 
			// Milonic menu
			fixMilonicMenu(name);
			postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Milonic fix). See browser.js for details.');
			return;
		
	      }else if(  match.call(name, /menu\d*_(com|build|var|program|compact)\.js$/)   ){ 
			// HV menu
			fixHVMenu(name);
			postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (HVMenu fix). See browser.js for details.');
			return;
	      }else if(  match.call(name, /coolmenus\d?.js$/)   ){ 
			// coolmenus menu
			fixCoolmenus(name);
			postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Coolmenus fix). See browser.js for details.');
			return;
	      }else if(  match.call(name, /udm[_-]/)  || (  match.call(name, /(sniffer|control)\.js$/)   )    ){ 
			// UDM menu
			addEventListener.call(opera, 'BeforeScript', function(ev){
				match.call=postError.call=call;
				if( match.call(name, /udm[_-]/)  || indexOf.call(ev.element.text, 'UDM')>-1 || indexOf.call(ev.element.text, 'um.ov=um.ov.split(/opera[\\/ ]7./);um.ov=um.pi(um.ov[1].charAt(0));')>-1 ){
					fixUDM(name);
					postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Coolmenus fix). See browser.js for details.');
				}
			}, false);
			return;
	      }else if(  indexOf.call(name, 'dynapi/api/browser.js')>-1  || indexOf.call(name, 'dynlayer.js')>-1  ){
			navRestore['appName'] = navigator.appName;
			navigator.appName = 'Microsoft Internet Explorer';
			shouldRestore = true;
			postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (DynAPI fix). See browser.js for details.');
		}else if(  match.call(name, /stm(\d+|_menu).js$/)  ){
			fixSoThinkMenus();
			postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (SoThink fix). See browser.js for details.');
		}else if( indexOf.call(name, 'transmenu')>-1 ){
			fixTransmenus();
			postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Transmenu fix). See browser.js for details.');
		}else if( indexOf.call(name, 'xaramenu')>-1 ){
			addPreprocessHandler( new RegExp('if\\(navigator.userAgent.indexOf\\(\'Opera\'\\)!=-1\\)\\s*NS4=1;', ''), 'if(navigator.userAgent.indexOf(\'Opera\')!=-1){IE5=1;NS6=0;}');
			postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Xaramenu fix). See browser.js for details.');
		}else if(  indexOf.call(name, '/richtext.js')>-1  ){ // Bug 230549, bug 208097
			// Rich text editor checks for "On" where Opera and FireFox return "on". sigh. 
			addPreprocessHandler( 'designMode != "On"', 'designMode != "on"', true, function(t){indexOf.call=call;return indexOf.call(t.text, 'kevinroth.com')>-1;} );
			postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Rich text editor submit fix). See browser.js for details');
		}else if( parseFloat.call(window, version.call())<9.5 && indexOf.call(name, '/novell/webaccess/images/msglist.js')>-1){ // Bug 92454, workaround for NWA
			defineMagicFunction.call(opera, 'fixContentHeight',
				function(oF, oT){
					document.documentElement.clientHeight=window.innerHeight;
					oF.apply(oT, slice.call(arguments, 2));
			});
			postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Height function fix). See browser.js for details');
		}else if( indexOf.call(name, 'awmlib')>-1 ){
				opera.addEventListener('BeforeScript', fixLiknoAllWebMenus, false);
		}else if( indexOf.call( name, 'tiny_mce' )>-1 && 'designMode' in document){
			if( parseFloat.call(window, version.call())<9.5  ){
				postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (TinyMCE paste+enter fix). See browser.js for details');
				addEventListener.call( document, 'load', function(){
					for(var i=0,f;f=frames[i];i++){
						try{
							if( ! match.call(f.name, /^mce_editor/) )continue;
							(function(f){
								addEventListener.call(f.document, 'keypress', function(e){
									if(e.keyCode==13){
										var sel = f.getSelection();
										if( sel.anchorNode == f.document.documentElement ){
											var rng = sel.anchorNode.ownerDocument.createRange();
											rng.selectNodeContents(sel.anchorNode.ownerDocument.body);
											rng.collapse( true );
											sel.removeAllRanges();
											sel.addRange(rng);
										}
									}
								},true );
							})(f);
						}catch(e){}
					}
				}, false);
			}else{ // patches for 9.5 and up
				opera.addEventListener('BeforeScript', function(e){ // 335463, lines reversed on enter by workaround against old Opera bug
					if( e.element.text.match( /majorVersion\s*=\s*"2"/ ) || ( e.element.text.match( /majorVersion\s*:\s*'3'/ ) && e.element.text.match(/minorVersion\s*:\s*'0/) ) ){
						postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (legacy TinyMCE enter fix + link button fix). See browser.js for details');
						e.element.text = e.element.text.replace( /if\s*\((tinyMCE\.|)isOpera\)\s*\{(\s*(\w{1,}\.normalize\(\);|)\s*\w{1,}\.insertNode\(\s*\w{1,}\s*\);)/g , 'if(false){$2' );
						opera.addEventListener('AfterEvent.DOMContentLoaded', function(){ // 345778, create link button not available
							if( typeof TinyMCE_Selection !='undefined' ){
								TinyMCE_Selection.prototype.getSelectedText=function(){return this.getSel().toString();};
							}
						},false);
					}
					opera.removeEventListener('BeforeScript', arguments.callee, false);
				},false);
				if( parseFloat.call(window, version.call(opera))==9.5  ){
					opera.addEventListener( // 336566, enabling designMode before using document.write will disable it again in the new document
						'BeforeEvent.load',
						function(e){
							var patch_is_required = true;
							if( typeof TinyMCE_Engine == 'undefined' ) return;
							try{
								if((new TinyMCE_Engine).majorVersion>=3){ // fix not required for versions 3 and above, remove event listener and quit
									patch_is_required=false;
								}
							}catch(e){}
							if( ! patch_is_required ){
								opera.removeEventListener('BeforeEvent.load', arguments.callee, false); return;
							}
								if(e.event.target && e.event.target.tagName && e.event.target.tagName.toUpperCase()=='IFRAME'){ // load event for IFRAME
								var iframe=e.event.target;
								if( iframe.id && iframe.id.match(/^mce_editor_\d/) && iframe.contentDocument ){
									iframe.contentDocument.designMode='on';
									postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (legacy TinyMCE document.write fix). See browser.js for details');
								}
							}
						},
						false
					);
				}
			}
			if( indexOf.call(name, 'tiny_mce_popup')!=-1 ){ // Working around a workaround for onload handling differences, 275267
				addEventListener.call(window, 'load', function(){
					var versionChecker = new tinyMCEPopup.windowOpener.TinyMCE_Engine;
					if(versionChecker.majorVersion<3 && versionChecker.minorVersion <1.3 ){
						document.body.onload();
					}
				}, false );
			}
		}else if(indexOf.call(name, 'dev.virtualearth.net/mapcontrol/mapcontrol.ashx')>-1 && window.SVGDocument){
			navRestore.userAgent = navigator.userAgent;
			navigator.userAgent+='KHTML';//356736
			shouldRestore=true;
		}else if(indexOf.call(name,'s_code')>-1){
			avoidDocumentWriteAbuse();
		}
		
		// Creating event handler to restore any changed navigator properties
		if( shouldRestore ){
			addEventListener.call(opera, 'AfterExternalScript', 
				function(ev){
					removeEventListener.call=call;
					var prop;
					for(prop in navRestore) navigator[prop]=navRestore[prop];
					removeEventListener.call(opera, 'AfterExternalScript', arguments.callee, false);
				}
			, false);
		}
	}, false);
			// 329543, Allow scripts to define reserved word top, but not not allow javascript: URLs to read the custom value
	try{
	var realWindowTop = window.top;
	var duringJSUrl = false;
	var topWasSet=false;
	var topValue;
	opera.addEventListener('BeforeJavaScriptURL', function( e ){
		duringJSUrl=true;
	}, false);
	opera.addEventListener('AfterJavaScriptURL', function( e ){
		duringJSUrl=false;
	}, false);
	opera.defineMagicVariable('top', function(){
		if( duringJSUrl ) return realWindowTop;
		return topWasSet ? topValue : realWindowTop;
	}, function(val){ topWasSet=true; topValue=val; });}catch(e){}
			// 366392, Compatibility layer for Google Gears initialization script
	if (window.opera && opera.createWorkerPool && 
	    navigator.mimeTypes["application/x-googlegears"] &&
	    navigator.mimeTypes["application/x-googlegears"].enabledPlugin
	    ){
		window.GearsFactory = function()
		{
		    var element = document.createElement("object");
		    element.style.display = "";
		    element.type = "application/x-googlegears";
	 
		    document.documentElement.insertBefore(element,
							  document.documentElement.firstChild);
		    element.getBuildInfo(); // to make sure init is complete
		    return element;
		}
	}
			// 246299, PDF security patch
	opera.addEventListener('BeforeJavaScriptURL', function( e ){
		unescape.call=toLowerCase.call=indexOf.call=preventDefault.call=call;
		var pathname=unescape.call(self, toLowerCase.call(self.location.pathname));
		var hash=unescape.call(self, toLowerCase.call(self.location.hash));
		if( /*indexOf.call(pathname, '.pdf')>-1 &&*/ hash  &&  indexOf.call(hash, 'javascript:')>-1   ) preventDefault.call(e);
	}, false);
			// 366749, document.domain can not be set to last TLD
	var oldDocDomainSetter = document.__lookupSetter__('domain');
	var oldDocDomainGetter = document.__lookupGetter__('domain');
	document.__defineSetter__('domain', function(newDomain){
		if( newDomain.indexOf('.')==-1 || newDomain.indexOf('.')==(newDomain.length-1) ){
			throw 'Security Exception: document.domain set to illegal value';
		}
		oldDocDomainSetter.call(this, newDomain);
	});
	document.__defineGetter__('domain', function(){
		return oldDocDomainGetter.call(this);
	});


	if( hostname.indexOf('.saab.')>-1 ){			// 145261,  sniffing on saab.com and saab.de excludes Opera
		opera.defineMagicVariable('isNAV6', function(){return true;}, null);
		opera.defineMagicVariable('isOPERA', function(){return false;}, null);
		opera.defineMagicVariable('isMAC', function(){return false;}, null);
		
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' ( sniffing on saab.com and saab.de excludes Opera). See browser.js for details');
	} else if((hostname=='www.opera.com' || hostname=='jp.opera.com') && pathname.indexOf('/docs/browserjs/')==0){			// 0, Browser.js status and version reported on browser.js documentation page
		document.addEventListener((parseInt(opera.version())>9?'DOMContentLoaded':'load'),function(){
			if(document.getElementById('browserjs_active')){
				document.getElementById('browserjs_active').style.display='';
				document.getElementById('browserjs_active').getElementsByTagName('span')[0].appendChild(document.createTextNode(bjsversion));
				document.getElementById('browserjs_status_message').style.display='none';
			}else if(document.getElementById('browserjs_status_message')){
				document.getElementById('browserjs_status_message').firstChild.data='Browser.js is enabled! '+bjsversion;
			}
		}, false);
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Browser.js status and version reported on browser.js documentation page). See browser.js for details');
	} else if(hostname.indexOf(  'music.download.com'  )>-1){			// 178744, Fixing audio samples, old overlibwms library only detects Opera7
		navigator.userAgent += ' Opera 7';
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Fixing audio samples, old overlibwms library only detects Opera7). See browser.js for details');
	} else if(hostname.indexOf( 'fileplanet.com' ) >-1 && href.indexOf('/sp_downloadmanager.aspx')>-1){			// 219257, Fileplanet.com sniffing blocks Opera
		opera.defineMagicVariable('agt',function(){return "win";},null);
		addPreprocessHandler( /(\b)window\s*.\s*opera(\b)/g,'$1undefined$2');
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Fileplanet.com sniffing blocks Opera). See browser.js for details');
	} else if(hostname.indexOf( 'moneta.co.kr')!=-1){			// 219041,  moneta.co.kr relies on IE quirks for CSS positioning
		addCssToDocument('#stocking{position:relative}#stocking>div{position:absolute}');
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' ( moneta.co.kr relies on IE quirks for CSS positioning). See browser.js for details');
	} else if(hostname.indexOf( 'nmviewogc.cr.usgs.gov' )!=-1){			// 233838, National Map Viewer on USGS relies on Netscape detection for functionality
		navigator.appName='Netscape';
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (National Map Viewer on USGS relies on Netscape detection for functionality). See browser.js for details');
	} else if(hostname.indexOf("rec.feeds.yahoo.")==0){			// 194334, Make "add feeds" dialog work in Y!Mail beta
		if( location.href.indexOf("bjs_getXMLMarkup")>=0 )location.href = location.href.replace("bjs_getXMLMarkup()","xml");
		navigator.product='Gecko';
		addCssToDocument('#FeedTabs div.panel{overflow:auto!important}body{overflow:hidden!important}');
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Make "add feeds" dialog work in Y!Mail beta). See browser.js for details');
	} else if(hostname.indexOf('.anz.com')!=-1){			// 343019, ANZ online bank form action URLs are incorrectly decoded
		workAroundBug343019();
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (ANZ online bank form action URLs are incorrectly decoded). See browser.js for details');
	} else if(hostname.indexOf('.dell.')!=-1&&hostname.indexOf('support.')!=-1){			// 286618,  browser sniffing on support.dell.com
		opera.defineMagicVariable( 'ig_shared', null, function(o){ o.IsNetscape6=true; return o; } );
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' ( browser sniffing on support.dell.com). See browser.js for details');
	} else if(hostname.indexOf('.ebay.')>-1){			// 226144, eBay: IFRAME expands forever
		document.addEventListener( (parseFloat(opera.version())>9?'DOMContentLoaded':'load'), function(){ try{
			if( ! window.frameElement)return; 
			document.onresize=null;document.body.onresize=null;
		}catch(e){}}, false );
		
				// 228707, eBay: speed up back+forward navigation
		opera.setOverrideHistoryNavigationMode('fast');
				// 318428, eBay tries to communicate with inaccessible IFRAMEs loading graphics from other servers over https
		if(location.protocol=='https:')document.addEventListener( 'load', function(e){
		    var el;
		    if( location.search.indexOf( 'ChooseUserIdAndPassword' )>-1 ){
			location.replace =  function(url){
						if( !  url.match(/^https:\/\/.*\.gif$/i)  )
							this.href = url;
					}
		    }
		    for(var all=document.getElementsByTagName('iframe'),i=0;el=all[i];i++){
			if( el.width<=1 && el.height<=1 && el.src.match(/^https:\/\/.*\.gif$/i) ){
				try{ var s=el.contentWindow.document.body; }catch(e){
					el.src='about:blank';
				}
			}
		    }
		}, false );
		
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (eBay: IFRAME expands forever\neBay: speed up back+forward navigation\neBay tries to communicate with...). See browser.js for details');
	} else if(hostname.indexOf('.ibm.com')>-1){			// 206984, IBM driver download has HTML comments inside SCRIPT tag, breaks parsing
		removeClosingHTMLComments();
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (IBM driver download has HTML comments inside SCRIPT tag, breaks parsing). See browser.js for details');
	} else if(hostname.indexOf('.icicibank.')!=-1){			// 343019, ICICI online bank form action URLs are incorrectly decoded
		workAroundBug343019();
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (ICICI online bank form action URLs are incorrectly decoded). See browser.js for details');
	} else if(hostname.indexOf('.mail.yahoo.')>-1&&(href.indexOf( '/dc/system_requirements?browser=blocked' )>-1||href.indexOf( '/dc/system_requirements?browser=unsupported' )>-1)){			// 194334, Y!Mail work around browser blocking
		location.href='/dc/launch?sysreq=ignore';
		
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Y!Mail work around browser blocking). See browser.js for details');
	} else if(hostname.indexOf('.mail.yahoo.')>=0 && pathname.indexOf('/dc/')==0){			// 290495, can't get past "new features" screen due to redirect
		document.addEventListener( 'DOMContentLoaded', function(){
			for( var link_count=0,element;element=document.links[ link_count ]; link_count++ ){
				if( element.getAttribute('href')=='/dc/launch?consentLW=1' )element.setAttribute('href', '/dc/launch?consentLW=1&sysreq=ignore');
			}
		} ,false );
		
				// 307369, Y!Mail button attribute "action" is a URL in WF2
		HTMLButtonElement.prototype.__defineSetter__('action', function(o){this._action=o});
		HTMLButtonElement.prototype.__defineGetter__('action', function(){return this._action});
				// 315686, Remember to create documentElement properties on XML nodes
		addPreprocessHandler( 'oEl.XMLDocument=oNewDOM;', 'oEl.XMLDocument=oNewDOM;oEl.documentElement=oNewDOM.documentElement;' );
		
				// 321384, createElement in XML document should put un-prefixed nodes in null namespace
		var docCreateElement = Document.prototype.createElement;
		if( window.XMLDocument ){
			XMLDocument.prototype.createElement = function(n){ return n.indexOf(':')==-1 ? this.createElementNS(null, n) : docCreateElement.call(this,n); }
		}else{
			Document.prototype.createElement = function(n){ return n.indexOf(':')==-1 ? this.createElementNS(null, n) : docCreateElement.call(this,n); }
		}
				// 194334, Make sure dragging does not cause visible selections
		addCssToDocument('[unselectable]::selection, [unselectable] ::selection { background-color: transparent; color: inherit }');
				// 327060, Clearfix character causes extra padding
		addCssToDocument('.clearfix:after { position: absolute }');
				// 327060, Hidden iframe isn't actually hidden, causes weird white rect behind dialogs
		addCssToDocument('.backingIframe { border-width: 0; opacity: 0.01 } ');
				// 327060, Shadow on dialogs is messed up, so fix it
		addCssToDocument('.dialogFooterCenter { font-size: 0; line-height: 0 } ');
				// 327060, The hidden <input type="file"> for the "Attach" button not hidden in Merlin on Mac OS X
		addCssToDocument('.transparent_attach_btn { padding: 0 !important; background-color: white !important; clip: rect(0 0 0 0) !important; z-index: 1 !important } ' +
						// Make sure all the buttons are above the <input type="file">...
						'#messageToolbar > table { position: relative; z-index: 102 } ' +
						// ...except for the "Attach" button
						'#messageToolbar #btnTbl_Attach { z-index: 0 !important }');
				// 194334, Y!Mail making sure addRule doesn't throw x-doc security errors
		if(!CSSStyleSheet.prototype.addRule )
			CSSStyleSheet.prototype.addRule = function( selector, css ){
				try{
					this.insertRule(selector+" { "+css+" }",this.cssRules.length);
				}catch(ex){}
			};
		
				// 194334, Y!Mail To: / CC: autocomplete fails because boundingLeft is not supported
		HTMLInputElement.prototype.createTextRange=HTMLTextAreaElement.prototype.createTextRange=null;
		
		
				// 194334, Y!Mail faking oncontextmenu support
		fakeOncontextmenu(false, 500)
				// 353880, Y!Mail reversed mouse wheel scrolling
		opera.addEventListener('BeforeEvent.mousewheel', function(e) {
			var d = e.event.wheelDelta * -1;
			e.event.__defineGetter__('wheelDelta', function() { return d });
		}, false);
				// 194334, Y!Mail remove selectSingleNode and selectNodes
		/* because Yahoo mail is better at emulating proprietary IE functions than we are.. */
		Node.prototype.selectSingleNode=undefined;
		Node.prototype.selectNodes=undefined;
				// 366564, Define document on iframe.contentWindow even while it is loading
		HTMLIFrameElement.prototype.__defineGetter__('contentWindow', function(){
			if( ! this.contentDocument ){
				return { document:{} };
			}
			return this.contentDocument.defaultView;
		}); 
				// 241691, Y!Mail doesn't load if identifying as IE
		navigator.userAgent = navigator.userAgent.replace( /MSIE/, '' );
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (can\'t get past "new features" screen due to redirect\nY!Mail button attribute "action" is a URL in W...). See browser.js for details');
	} else if(hostname.indexOf('.t-online.de')>-1){			// 225374,  video problems on T-online.de
		if(hostname.indexOf('onunterhaltung')>-1){
					//Fix browser detection
					opera.defineMagicFunction( 'allResultsOK', function(){return true;} );
					// Fix plugin detection
					opera.defineMagicVariable( 'fHasWMP64', function(){ return navigator.mimeTypes['application/x-mplayer2'].enabledPlugin?true:false }, null )
					opera.defineMagicVariable( 'fHasWMP7', function(){ return navigator.mimeTypes['application/x-mplayer2'].enabledPlugin?true:false }, null )
					opera.defineMagicVariable( 'WMPVer', function(){ try{return fHasWMP64?'6.4':'unknown'}catch(e){return '6.4'} }, null )
			opera.addEventListener( 'BeforeScript',function(e){
				replace.call=call;
				e.element.text=replace.call(e.element.text,  'playerframe.Player.url=url;', 'playerframe.Player.url=url;nplayerframe.Player.Open(url);' );
			},false );
					// use TYPE as well as CLASSID on OBJECT tags in markup
					var objId='Player';
					var objref=null;
					document.addEventListener('DOMContentLoaded', function(e){ 
						if( ! (objref=document.getElementById(objId) ) ) return;
						if(objref.getAttribute('classid')=="CLSID:6BF52A52-394A-11d3-B153-00C04F79FAA6")objref.type='application/x-mplayer2';
					}, false);
					// Remove UI that depends on ActiveX scripting. Built-in WMP UI will do..
					document.addEventListener('DOMContentLoaded', function(e){ 
						var pb=document.getElementById('playBtn');
						var wmp=document.getElementById('playerframe');
						if( pb&&wmp ){
							pb.parentNode.style.visibility='hidden';	wmp.style.visibility='visible';
							try{ document.images.tonaus.height=0;document.images.tonaus.width=0;}catch(e){}
						}
					}, false);
		}
				// 231082,  video problems on T-online.de, VOD section
				if( hostname.indexOf('vod')>-1 ){ // 231082
					navigator.userAgent+=' Firefox';
				}
		
				// 231082,  video problems on T-online.de, WMP license installation
		if(href.indexOf('__license=delivered')>-1){
			location.replace( location.href.replace( /__license=delivered/, '?license=delivered' ) );
		}
		
				// 226414,  video problems on T-online.de, no window.external detection
		window.external=window.external||{};
		
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' ( video problems on T-online.de\n video problems on T-online.de, VOD section\n video problems on T-on...). See browser.js for details');
	} else if(hostname.indexOf('.ulead.') >-1){			// 142757, Ulead.com old Milonic menu
		 fixMilonicMenu('mmenu.js');
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Ulead.com old Milonic menu). See browser.js for details');
	} else if(hostname.indexOf('.yahoo.')>-1&&hostname.indexOf('mail')==-1){			// 101146, Yahoo ISP portal blocks Opera users
		addPreprocessHandler( /d\.location\.href = ".*?\/browser_upgrade\.html";/g, '');
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Yahoo ISP portal blocks Opera users). See browser.js for details');
	} else if(hostname.indexOf('able.co.jp')>-1){			// 253081,  able.co.jp uses capturing event listeners
		preventEventCapture( HTMLAnchorElement.prototype, 'click' );
		preventEventCapture( HTMLSelectElement.prototype, 'change' );
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' ( able.co.jp uses capturing event listeners). See browser.js for details');
	} else if(hostname.indexOf('ameba.jp')!=-1){			// 331093, Enable blog post editor on ameba.jp
		navigator.product='Gecko';
		navigator.userAgent=navigator.userAgent.replace('Opera', '0pera (spoofing as Firefox)');
				// 331093, Work around Opera bug where second BR tag overwrites newly inserted IMG
		addPreprocessHandler(/editor\.insertNodeAtSelection\(link\);\s*editor\.insertNodeAtSelection\(document\.createElement\('br'\)\);/, 'editor.insertNodeAtSelection(link);');
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Enable blog post editor on ameba.jp\nWork around Opera bug where second BR tag overwrites newly inse...). See browser.js for details');
	} else if(hostname.indexOf('aol.com') >-1){			// 179219, AOL miscalculated widths cause overlaps at top
		opera.addEventListener('BeforeEvent.'+(opera.version()>9?'DOMContentLoaded':'load'), function(ev){ if(ev.event.target!=document)return;
		var i;
		i = getElementById.call(document, 'static'); if(i){ i.style.width = (i.offsetWidth-2)+'px';}
		}, false);
				// 226390, AOL browser sniffing blocks opera  
		opera.defineMagicVariable( 'is_supported', function(){return 1;}, null);
		
				// 214747, AOL: when IFRAME invisible GIF is served over https, script can not update location
		if(location.protocol=='http:'){addPreprocessHandler( new RegExp('https://sns-static.aolcdn.com/', 'g'), 'http://sns-static.aolcdn.com/', false );}
		
				// 188197, Making sure AOL pages are not overwritten by ad script
		avoidDocumentWriteAbuse();
				// 262693, AOL browser sniffing causes missing styling
		document.addEventListener('DOMContentLoaded', function(){document.documentElement.className='SAF';}, false);
				// 262693, AOL click tracking breaks news slide show control buttons
		opera.defineMagicFunction('s_gi', function(){return {t:function(){return {};}};});
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (AOL miscalculated widths cause overlaps at top\nAOL browser sniffing blocks opera  \nAOL: when IFRAM...). See browser.js for details');
	} else if(hostname.indexOf('apple.viamichelin.com')>-1){			// 288490, Text on Apple store locator page is misaligned and overlapping
		addCssToDocument('center table{text-align: left} div#poilist table td img+img:before{ content: "\A" }')
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Text on Apple store locator page is misaligned and overlapping). See browser.js for details');
	} else if(hostname.indexOf('att.com')!=-1){			// 206467, ATT / Bellsouth browser sniffing
		opera.defineMagicVariable( 'isDHTML', function(){return true;}, null );
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (ATT / Bellsouth browser sniffing). See browser.js for details');
	} else if(hostname.indexOf('barnesandnoble.com')>-1){			// 195961, Barnes&Noble uses "required" attributes on elements that aren't required
		document.addEventListener('load', function(){var nodes=document.evaluate('//input[@required]', document.body,null,null,null),node=null; while(node=nodes.iterateNext()){ node.removeAttribute('required'); }},false);
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Barnes&Noble uses "required" attributes on elements that aren\'t required). See browser.js for details');
	} else if(hostname.indexOf('bbs.dzart.net')!= -1){			// 361539, Avoid manipulating broken Discuz! markup on bbs.dzart.net
		opera.defineMagicFunction('announcementScroll', function(){});
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Avoid manipulating broken Discuz! markup on bbs.dzart.net). See browser.js for details');
	} else if(hostname.indexOf('bbs.hxsd.com')!= -1){			// 361510, Broken CSS makes fonts too small on bbs.hxsd.com
		addCssToDocument('body{font-size:75%}');
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Broken CSS makes fonts too small on bbs.hxsd.com). See browser.js for details');
	} else if(hostname.indexOf('bbs.kafan.cn')!= -1){			// 361525, Setting innerHTML to badly nested markup breaks forum layout on bbs.kafan.cn
		opera.defineMagicFunction('parsetag',function(){});
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Setting innerHTML to badly nested markup breaks forum layout on bbs.kafan.cn). See browser.js for details');
	} else if(hostname.indexOf('betfair.com')>-1){			// 309459, Betfair relies on firstChild defined on attribute nodes
		Attr.prototype.__defineGetter__("firstChild", function() {return this;});
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Betfair relies on firstChild defined on attribute nodes). See browser.js for details');
	} else if(hostname.indexOf('bioware.com')>-1){			// 239590, bioware.com uses outdated HierMenus
		fixHierMenus();
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (bioware.com uses outdated HierMenus). See browser.js for details');
	} else if(hostname.indexOf('blogger.com')>-1){			// 177059, Blogger: browser detection prevents WYSIWYG editing
		navigator.product = 'Gecko';
		navigator.userAgent = navigator.userAgent.replace(/Opera/, 'Firefox')+' ( rv:1.9.0.3)';
		
		opera.defineMagicVariable(
			'Detect',
			function( obj ){return obj;},
			function( obj ){
				obj.OPERA = function(){return false;}
				obj.MOZILLA = function(){return true;}
				obj.IE=function(){return false;}
				obj.IE_5_5_newer=function(){return false;}
				return obj;
			}
		);
		
				// 187226, Blogger: Should distinguish AltGr and Ctrl
		opera.defineMagicFunction('isCtrlKeyPressed', function(f, t, e){ return e.ctrlKey&&!e.altKey;  });
		opera.defineMagicVariable( 'IE_KEYSET', function(){ return true; },null );
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Blogger: browser detection prevents WYSIWYG editing\nBlogger: Should distinguish AltGr and Ctrl). See browser.js for details');
	} else if(hostname.indexOf('bloglines.com')>-1){			// 248295, Bloglines, designMode case sensitivity issue
		addPreprocessHandler( 'designMode != "On"', 'designMode != "on"', true, function(t){indexOf.call=call;return indexOf.call(t.text, 'kevinroth.com/rte/demo.htm')>-1;} );
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Bloglines, designMode case sensitivity issue). See browser.js for details');
	} else if(hostname.indexOf('bookryanair.com')>-1){			// 319803, Make Opera's built-in WF2 validation ignore required attributes on bookryanair.com
		ignoreRequiredAttributes();
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Make Opera\'s built-in WF2 validation ignore required attributes on bookryanair.com). See browser.js for details');
	} else if(hostname.indexOf('britannica.com')>-1){			// 332948, Prevent overwriting document with stats graphic on britannica.com
		avoidDocumentWriteAbuse();
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Prevent overwriting document with stats graphic on britannica.com). See browser.js for details');
	} else if(hostname.indexOf('britishairways.')!=-1){			// 206810, Prevent britishairways.com from reloading the page on resize
		opera.defineMagicFunction('resizeHandler', function(){});
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Prevent britishairways.com from reloading the page on resize). See browser.js for details');
	} else if(hostname.indexOf('bugs.co.kr')>-1){			// 279133, bugs.co.kr reloads due to SCRIPT with for and event attributes
		scriptForEventFix();
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (bugs.co.kr reloads due to SCRIPT with for and event attributes). See browser.js for details');
	} else if(hostname.indexOf('cajamadrid.es')!=-1){			// 346825, Caja Madrid hides login form by CSS mistake
		addCssToDocument('body:last-child .clearfix {content:normal!important;}');
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Caja Madrid hides login form by CSS mistake). See browser.js for details');
	} else if(hostname.indexOf('capitalone.com')>-1&&location.protocol=='https:'){			// 86032, CapitalOne login fails - cross-domain access on https disallows setting location
		document.domain='capitalone.com';
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (CapitalOne login fails - cross-domain access on https disallows setting location). See browser.js for details');
	} else if(hostname.indexOf('cdec-sic.cl')!=-1){			// 365516, Old HierMenus on cdec-sic.cl
		fixHierMenus();
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Old HierMenus on cdec-sic.cl). See browser.js for details');
	} else if(hostname.indexOf('chase.com')!=-1){			// 243036, chase.com field refocus from onkeypress-problem
		opera.defineMagicFunction('handleTabs', function(oT, oF, name){
			var el=document.getElementById(name);
			if(el && el.value.length+1>=el.maxLength && !(event.keyCode==8||event.keyCode==46)){
				setTimeout( function(){ jumpToNext(el); }, 100);
			}
			function jumpToNext(el){
				var i=0;
				if(el.form){while(el!=el.form[i])i++;}else{ return;}
				if(el.form[i+1])el.form[i+1].focus();
			}
		});
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (chase.com field refocus from onkeypress-problem). See browser.js for details');
	} else if(hostname.indexOf('chosun.com')>-1){			// 279130, Morningplus.chosun.com misplaced content
		addCssToDocument('#scroll_image{ position: relative }');
				// 209929, chosun.com scrollarea fix
		addCssToDocument('#nscrollarea, #nscrolltxt{display: inline !important}');
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Morningplus.chosun.com misplaced content\nchosun.com scrollarea fix). See browser.js for details');
	} else if(hostname.indexOf('continental.com')>-1){			// 263594, Continental.com document.activeElement fix enables airport choice popup
		opera.addEventListener('BeforeEventListener.click', function(e){if(e.event.target && e.event.target.tagName=='A')document.activeElement=e.event.target; }, false);
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Continental.com document.activeElement fix enables airport choice popup). See browser.js for details');
	} else if(hostname.indexOf('deviantart.com')>-1){			// 282065,  deviantart.com prevents mousedown on file inputs, making it impossible to select files
		opera.addEventListener('BeforeEventListener.mousedown', function(e){
		func_toString.call=preventDefault.call=call;
				if( func_toString.call(e.listener)=='function(){return false}' && e.event.target.tagName=='INPUT' ){
					preventDefault.call(e);
				}
			}, false);
				// 314246, Work around bug that breaks Deviantart categories menu
		opera.addEventListener('BeforeEvent.blur', function(e){if(e.event.target==self)e.preventDefault();}, false);
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' ( deviantart.com prevents mousedown on file inputs, making it impossible to select files\nWork around...). See browser.js for details');
	} else if(hostname.indexOf('estadao.com.br')!=-1){			// 279595,  Estadao redefines window.XMLHttpRequest with a function declaration
		var _XHR=window.XMLHttpRequest;
		opera.defineMagicVariable('XMLHttpRequest', function(){return _XHR;}, null);
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' ( Estadao redefines window.XMLHttpRequest with a function declaration). See browser.js for details');
	} else if(hostname.indexOf('fedex.com')!=-1){			// 363564, FedEx.com mangles tables by turning TDs into block elements
		document.addEventListener('DOMContentLoaded', function(){ for(var els=document.getElementsByTagName('td'),el,i=0;el=els[i];i++)if(el.style.display=='block')el.style.display='';}, false);
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (FedEx.com mangles tables by turning TDs into block elements). See browser.js for details');
	} else if(hostname.indexOf('fotocenter.aol.de')>-1){			// 202045, AOL: browser warnings for various features of aol.de
		document.cookie='NewportUnsupportedBrowserAccepted=true;';
		
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (AOL: browser warnings for various features of aol.de). See browser.js for details');
	} else if(hostname.indexOf('gallery.live.com')>-1){			// 262961, Live.com properties overwrite page from click tracking script
		opera.defineMagicFunction( 'RegisterOmnitureAction', function(){} );
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Live.com properties overwrite page from click tracking script). See browser.js for details');
	} else if(hostname.indexOf('geoaccess.com')!=-1){			// 318050,  BlueCross browser sniffing prevents insurance search
		opera.defineMagicVariable('is_nav', function(){return true;}, null);
		
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' ( BlueCross browser sniffing prevents insurance search). See browser.js for details');
	} else if(hostname.indexOf('ibank.isb.ru')!=-1){			// 0, browser sniffing breaks ibank.isb.ru
		navigator.__defineGetter__('family', function(){return 'gecko';})
		navigator.__defineSetter__('family', function(){})
		
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (browser sniffing breaks ibank.isb.ru). See browser.js for details');
	} else if(hostname.indexOf('icelandair.')!=-1){			// DSK-238649, jQuery script scheduling trouble on Icelandair
		fixJQueryScriptSchedulingTrouble();
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (jQuery script scheduling trouble on Icelandair). See browser.js for details');
	} else if(hostname.indexOf('iieye.com')!= -1){			// 361535, IE detection prevents other browsers from accessing iieye.com
		opera.defineMagicVariable('isIE',function(){return true;}, null);
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (IE detection prevents other browsers from accessing iieye.com). See browser.js for details');
	} else if(hostname.indexOf('ingdirect.com.au')>-1){			// 352969, Make Opera's built-in WF2 validation ignore required attributes on ingdirect.com.au
		ignoreRequiredAttributes();
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Make Opera\'s built-in WF2 validation ignore required attributes on ingdirect.com.au). See browser.js for details');
	} else if(hostname.indexOf('isbank.com.tr')>-1){			// 265077,  fixing navigation menu on isbank.com.tr
		opera.addEventListener('BeforeScript', function(e){ replace.call=call; e.element.text=replace.call(e.element.text, 'SaklaGoster(sFrameAdi, 0, i.sMenuAd);};else if', 'SaklaGoster(sFrameAdi, 0, i.sMenuAd);}else if') },false);
		
				// 265077, fixing keypress handler on isbank.com.tr
		var ignoreKeypressCodes = {8:'',9:'',16:'',17:'',35:'',36:'',37:'',38:'',39:'', 40:'',45:'',46:''};
		opera.addEventListener('BeforeEventListener.keypress', function( e ){ preventDefault.call=call; if( e.event.keyCode in ignoreKeypressCodes) preventDefault.call(e); }, false)
		
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' ( fixing navigation menu on isbank.com.tr\nfixing keypress handler on isbank.com.tr). See browser.js for details');
	} else if(hostname.indexOf('klm.com')>-1){			// 213449, KLM uses Gecko-specific originalTarget
		addPreprocessHandler( /if \(e\) if \(e\.originalTarget\./g, 'if (e && e.originalTarget) if (e.originalTarget.' );
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (KLM uses Gecko-specific originalTarget). See browser.js for details');
	} else if(hostname.indexOf('kr.msn.com')!=-1){			// 349584, head layout broken on kr.msn.com
		addCssToDocument('li:after, ul:after{display:none!important}');
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (head layout broken on kr.msn.com). See browser.js for details');
	} else if(hostname.indexOf('lgmobile.com')!=-1 ){			// 331748,  LG Mobile Flash does not load as expected because of missing type attribute
		document.addEventListener( 'DOMContentLoaded', function(e){
			for( var elements=document.getElementsByTagName('object'),element,i=0; element=elements[i]; i++){
				if( element.parentNode.tagName.toUpperCase() == 'OBJECT' )continue;
				if(element.getAttribute('classid')=='clsid:D27CDB6E-AE6D-11cf-96B8-444553540000' && ! element.getAttribute('type') ){
					element.setAttribute('type', 'application/x-shockwave-flash');
					element.parentNode.replaceChild( element.cloneNode(true), element );
				}
			}
		}, false)
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' ( LG Mobile Flash does not load as expected because of missing type attribute). See browser.js for details');
	} else if(hostname.indexOf('mail.126.com')!=-1){			// PATCH-5, can't read E-mail on 126.com due to XML parse error
		addPreprocessHandler(
		/if\(([A-Za-z0-9_$]*)=="opera"\)\{[A-Za-z0-9_$]*=[A-Za-z0-9_$]*\.replace\(\/&lt;\/gi, "<"\)\.replace\(\/&gt;\/gi, ">"\);\}/, 'if(false){}');
		
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (can\'t read E-mail on 126.com due to XML parse error). See browser.js for details');
	} else if(hostname.indexOf('mail.163.com')!= -1){			// 347923, Fixed add files issue in mail.163.com
		addCssToDocument('.upload .input_browser { width:auto !important}');
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Fixed add files issue in mail.163.com). See browser.js for details');
	} else if(hostname.indexOf('mail.google.')>-1){			// 244011, GMail deletes messages on End key presses
		opera.addEventListener( 'BeforeEventListener.keypress', function(e){
			preventDefault.call=call;
			if(e.event.keyCode==35){
				preventDefault.call(e);
			}
		}, false );
				// 196536, GMail: browser blocking prevents chat feature from appearing
		try{
		if( top.location.search.indexOf('ui=1')!=-1 ){
			if(top.location.search.indexOf('auth')>-1){
			    addPreprocessHandler( 'disablechatbrowsercheck', 'auth' );
			}else if(top==self&&!window.opener&&location.search.indexOf('disablechatbrowsercheck')==-1&&location.search.indexOf('ui=html')==-1&&pathname.indexOf('.html')==-1){
			    opera.addEventListener( 'AfterScript', function(e){
				if(top.frames.length>0){
					top.location.search+=(top.location.search)?'&disablechatbrowsercheck=1':'?disablechatbrowsercheck=1';
			    }}, false);
			}
		}
		}catch(e){}
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (GMail deletes messages on End key presses\nGMail: browser blocking prevents chat feature from appear...). See browser.js for details');
	} else if(hostname.indexOf('mail.live.com')!=-1){			// 228506, FireAnt.Debug.Trace tries to use arguments.callee.caller, which doesn't work in Opera (138530)
		opera.defineMagicVariable('FireAnt',
			function(curVal) {
				if (curVal && curVal.Debug) {
					curVal.Debug.Trace = function() { };
				}
				return curVal;
			},
			function(newVal) {
				return newVal;
			}
		);
		
				// 178077, Making sure button constants are DOM-standard compatible
		opera.addEventListener('BeforeScript', function(e) {
			try { window.Web.Browser.Button = { "LEFT": 0, "RIGHT": 2, "MIDDLE": 1 }; } catch(ex) {}
		}, false);
				// 178723, tagName is lowercase for some custom XML island elements
		opera.addEventListener('BeforeScript', function(e) {
			replace.call=call;
			e.element.text = replace.call(e.element.text, /FA\:LAYOUT/g, 'fa:layout');
		}, false);
				// 178723, Restore the opera UA string, because some of the Firefox fixes break in opera
		var stuff = navigator.userAgent.split('(')[1].split(')')[0].split(';');
		stuff.pop();
		navigator.userAgent = 'Opera\/' + opera.version() + ' (' + stuff.join(';') + ')';
		
		opera.addEventListener('BeforeScript', function() {
		        removeEventListener.call = call;
			removeEventListener.call(opera,'BeforeScript', arguments.callee, false);
			window.opera = opera;
		}, false);
		
				// 178723, Mispositioned menu
		if(window.frameElement && window.frameElement.name == 'main')addCssToDocument( '#uxp_hdr_meMenu { right: auto !important; left: auto !important }' );
		
				// 178723, Making sure elements have correct opacity applied during drag-drop
		if(window.frameElement && window.frameElement.name == 'main')addCssToDocument( '.Web_UI_DragDrop_Source { opacity: 0.25 }' );
		
				// 178723, The message pane splitter resizer  should not  be draggable when it is underneath a menu
		if(window.frameElement && window.frameElement.name == 'main')addCssToDocument( '.cContentColumn .ResizeSplitter { z-index: 98 !important }' );
		
				// 178723, Fixing checkboxes that appear on top of menus
		if(window.frameElement && window.frameElement.name == 'main')addCssToDocument( '.IconCell.blockclick input { z-index: 98 !important }' );
		
				// 178723, Opera doesn't recognize the IE text-overflow (or CSS3 text-overflow-mode) CSS property
		if(window.frameElement && window.frameElement.name == 'main')addCssToDocument( '.FolderList,.GroupList, .FolderListItem A.FolderInfoDiv ,' +
			'.FolderListItem .ContainerDiv,.ReadMessagePane,.ContactsReadPane,'+
			'.ContactsEditPane ,.TodayTabContainer .TabHeaders .TabHeaderUnselected,'+
			'.TodayTabContainer .TabHeaders .TabHeaderSelected, .ContactList,'+
			'.ListFooterInner, .FromCell,.SubjectCell,.SentMailContactListItem .Name,'+
			'.SentMailContactListItem .SentMailUserFeedbackCell { -o-text-overflow: ellipsis }' );
				// 178723, Prevent white lines inside buttons
		if(window.frameElement && window.frameElement.name == 'main')addCssToDocument( '.uxp_hdr_button { height: 18px }' );
				// 178723, Fix minimum font size issue
		if(window.frameElement && window.frameElement.name == 'main')addCssToDocument( '.Separator { font-size: 10px; height: 0.5em !important }' );
				// 178723, Prevent annoying scroll wheel behavior
		if(window.frameElement && window.frameElement.name == 'main')addCssToDocument( 'html { position: fixed !important; overflow: hidden }' );
				// 178723, Don't let the fixed position body mess up positioning calculations
		if(window.frameElement && window.frameElement.name == 'main'){var returnZero = function() { return 0 };
		document.documentElement.__defineGetter__('scrollTop',  returnZero);
		HTMLBodyElement.prototype.__defineGetter__('scrollTop', returnZero);
		document.documentElement.__defineSetter__('scrollTop', returnZero);
		HTMLBodyElement.prototype.__defineSetter__('scrollTop', returnZero);}
				// 165310, Fake oncontextmenu support
		if(window.frameElement && window.frameElement.name == 'main')fakeOncontextmenu(true,false);
				// 178723, autocomplete fix (mouse)
		if(window.frameElement && window.frameElement.name == 'main')window.addEventListener('blur', function(evt) {
			if (evt.target instanceof HTMLTextAreaElement) {
				evt.stopPropagation();
			}
		}, true);
		
				// 306274, onkeydown and onclick both fire when [enter] key is pressed on a focused element
		if(window.frameElement && window.frameElement.name == 'main')window.addEventListener('keydown', function(evt) {
			if (evt.target instanceof HTMLAnchorElement &&
					evt.keyCode == 13) {
				evt.stopPropagation();
			}
		}, true);
		
				// 234302, Don't insert new lines into the "to" field when you press [enter] to confirm autocomplete
		var cancelCodesTable = {/*9,*/ 13:'', 16:'', 17:'', 18:'', 27:'', 33:'', 34:'', 35:'', 36:'', 38:'', 40:''};
		var keypressListener = function(evt) {
			evt.preventDefault();
		};
		if(window.frameElement && window.frameElement.name == 'main')window.addEventListener('keydown', function(evt) {
			if (evt.target instanceof HTMLTextAreaElement &&
					evt.target.className.indexOf('AutoComplete') + 1) {
				if (typeof (cancelCodesTable[evt.keyCode]) != 'undefined') {
					var prevLength = evt.target.value.length;
					// Fix text selection after autocomplete in Merlin
					if ( parseFloat(opera.version())<9.5 ) {
						evt.target.addEventListener('keypress', function(evt) {
							var target = evt.target;
							var length = target.value.length;
							var delta = length - prevLength;
							var selStart = parseInt(target.selectionStart, 10) + delta;
							var selEnd = parseInt(target.selectionEnd, 10) + delta;
							if (selStart >= length) selStart = length;
							if (selEnd >= length) selEnd = length;
							target.setSelectionRange(selStart, selEnd);
							target.removeEventListener('keypress', arguments.callee, false);
						}, false);
					}
					evt.target.addEventListener('keypress', keypressListener, false);
					return;
				}
			}
			evt.target.removeEventListener('keypress', keypressListener, false);
		}, true);
				// 178723, Keep window.event updated
		// Update window.event when we dispatch our own events
		var events =
			['mousedown',
			'mouseup',
			'mousemove',
			'mouseenter',
			'mouseleave',
			'click',
			'dblclick',
			'mouseover',
			'mouseout',
			'contextmenu',
			'keydown',
			'keypress',
			'keyup',
			'focus',
			'blur',
			'losecapture'];
		var i = events.length - 1;
		do {
			window.addEventListener(events[i], function(evt) { window.event = evt; }, true);
		} while (i--);
		
				// 178723, Emulating some of IE's DOM-CSS methods
		var styleSheets = document.styleSheets;
		document.styleSheets = function(s) {
			if (typeof s == 'number') return styleSheets[s];
			//    v--assignment statement!
			if (s = document.getElementById(s)) return s.sheet;
		};
		CSSStyleDeclaration.prototype.getAttribute = function(a) {
			return this[a];
		};
		CSSStyleDeclaration.prototype.setAttribute = function(a, v) {
			return this[a] = v;
		};
				// 178723, Emulating IE's cssText property on style sheets
		var getCssText = function() {
			if (!this.href)	{
				return this.ownerNode.textContent;
			} else {
				try {
					var xhr = new XMLHttpRequest();
					xhr.open('GET', this.href, false);
					xhr.send();
					return xhr.responseText;
				} catch(e) {
					return '';
				}
			}
		};
		if (window.__defineGetter__) {
			CSSStyleSheet.prototype.__defineGetter__('cssText', getCssText);
			CSSStyleSheet.prototype.__defineSetter__('cssText', function(v) {
				if (!this.href) {
					this.ownerNode.innerHTML = '';
					return this.ownerNode.appendChild(document.createTextNode(v));
				}
			});
		} else {
			window.addEventListener('load', function(){
				for( var i=0;i<document.styleSheets.length;i++ ){
					if(document.styleSheets[i])
						document.styleSheets[i].cssText = { _styleRef: document.styleSheets[i], toString:function(){
					return this._styleRef.ownerNode.textContent}
					};
				}
			},false);
		}
		
				// 178723, Emulate IE's uniqueID feature
		var intID = 0;
			Element.prototype.__defineGetter__('uniqueID', function() {
		    if (this.uid == null)
		      this.uid = 'ms_id' + intID++;
		    return this.uid;
			});
				// 178723, don't throw error on contains(null)
		(function(contains) {
			HTMLElement.prototype.contains = function() {
				try {
					return contains.apply(this, arguments);
				} catch(e) {
					return false;
				}
			};
		})(HTMLElement.prototype.contains);
				// 178723, Emulate IE's event capture
		if(window.frameElement && window.frameElement.name == 'main')emulateIECapturingEvents()
				// 178723, The RTE "insert link" box works only once because registered click event handlers trigger again and hide it
		addPreprocessHandler( /if\(mc\.style\.display=="none"\)mc\.style\.display="block";else/, 'if(mc.style.display=="none"){setTimeout(function(){mc.style.display="block"},10);}else' );
				// 321581, Make sure RTE is disabled in Hotmail Classic mode
		if( pathname.indexOf('Light.aspx')>-1 ){
			addCssToDocument('a[onclick*="PlainTextEditorMode(false)"]{display:none}');
			document.addEventListener('DOMContentLoaded', function() {
				try {
					var winconf = window.confirm;
					window.confirm = function(){return true;}// do not nag about loosing formatting when switching mode
					window.PlainTextEditorMode(true);
				} catch(ex) { }
				window.confirm = winconf;
			}, false);
		}
		
				// 327855, Handle scripts that set src after inserting SCRIPTs into DOM correctly
		HTMLScriptElement.prototype.__defineGetter__('src', function() {
			return this.getAttribute('src');
		});
		HTMLScriptElement.prototype.__defineSetter__('src', function(v) {
			var p, s;
			if (p = this.parentNode) {
				s = this.nextSibling;
				p.removeChild(this);
			}
			this.setAttribute('src', v);
			if (p) {
				if (s) {
					p.insertBefore(this, s);
				} else {
					p.appendChild(this);
				}
			}
		});
		
				// 345843, Fixes downloading attachments in Hotmail
		(function() {
			var x = document.createElement('iframe');
			var getSRC = x.__lookupGetter__('src');
			var setSRC = x.__lookupSetter__('src');
			x = null;
			var p = HTMLIFrameElement.prototype;
			p.__defineGetter__('src', function() {
				return getSRC.apply(this, arguments);
			});
			p.__defineSetter__('src', function(v) {
				if (v.indexOf('ScanAttachment.aspx') > -1) {
					this.contentWindow.location.href = v;
				} else {
					setSRC.apply(this, arguments);
				}
			});
		})();
				// DSK-235885, Hotmail uses lookupGetter on prototypes, not instances
		var styleSetterLookupMethod = document.createElement('span').style.__lookupSetter__;
		 CSSStyleDeclaration.prototype.__lookupSetter__ = function(prop){
			return styleSetterLookupMethod.call(document.createElement('span').style, prop);
		 };
				// CORE-15945, It's usually not necessary to define properties that are already supported with getters and setters.
		var realHTMLElementDefineGetter = HTMLElement.prototype.__defineGetter__;
		HTMLElement.prototype.__defineGetter__ = function(name, func){
			if( name in {'document':''} ) return;
			realHTMLElementDefineGetter.call(this, name, func);
		}
		
				// CORE-15973, Resize function causes rendering loop
		opera.defineMagicFunction('dap_Resize', function(){});
				// DSK-235885, RTE._getSelectionImpl must use the createRange for Mozilla
		document.addEventListener( 'load', function(e){
			if(e.target instanceof HTMLIFrameElement){
				e.target.contentDocument.selection.createRange = function(){return document.createRange(); };
			}
		},true);
		
				// DSK-235885, Adding editor area styling that is missing due to browser sniffing
		addCssToDocument('.RTE .Container iframe{width: 100% !important; height: 100% !important}');
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (FireAnt.Debug.Trace tries to use arguments.callee.caller, which doesn\'t work in Opera (138530)\nMaki...). See browser.js for details');
	} else if(hostname.indexOf('maps.live.com')!=-1){			// 165310, Fake oncontextmenu support
		fakeOncontextmenu(true,false);
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Fake oncontextmenu support). See browser.js for details');
	} else if(hostname.indexOf('marktplaats.nl')!=-1){			// PATCH-3, Can't add article to favourites because setting link.search has no effect
		HTMLAnchorElement.prototype.__defineGetter__('search', function(){return this.href.match(/\?.*/)||'';});
		HTMLAnchorElement.prototype.__defineSetter__('search', function(v){
			this.href+=v;});
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Can\'t add article to favourites because setting link.search has no effect). See browser.js for details');
	} else if(hostname.indexOf('maybank2u.com.my')>-1){			// 249799, maybank2u, onresize event causes a refresh whenever the softkeyboard is opened
		opera.addEventListener('BeforeEventListener.resize',function (e) { preventDefault.call=call;
			preventDefault.call(e);
		},false);
		opera.defineMagicFunction('MM_checkBrowser', function(){});
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (maybank2u, onresize event causes a refresh whenever the softkeyboard is opened). See browser.js for details');
	} else if(hostname.indexOf('millenet.pl')!=-1){			// PATCH-7, Semicolon insertion fails after do..while() conditional
		addPreprocessHandler(/;do num=Math\.ceil\(Math\.random\(\)\*maxNum\);while\(uniqueInt\.a\.hasMember\(num\)\)uniqueInt\.a\[uniqueInt\.a\.length\]=num;/, 'do num=Math.ceil(Math.random()*maxNum);while(uniqueInt.a.hasMember(num));uniqueInt.a[uniqueInt.a.length]=num;');
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Semicolon insertion fails after do..while() conditional). See browser.js for details');
	} else if(hostname.indexOf('monster.')!=-1){			// 315865, Monster category tree broken by their selectNodes function overwriting .text on nodes
		addPreprocessHandler( /(item|result)\.text\s*=\s*(item|result)\.textContent;\s*/g, 'if(typeof $1.text==\'undefined\')$1.text = $1.textContent;' );
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Monster category tree broken by their selectNodes function overwriting .text on nodes). See browser.js for details');
	} else if(hostname.indexOf('msnbc.com')>-1){			// 207178, MSNBC sniffing hides Flash content
		opera.defineMagicVariable('oSniff', function(o){return o;},function(){ window['oSniff'].nn=5; });
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (MSNBC sniffing hides Flash content). See browser.js for details');
	} else if(hostname.indexOf('music.mu-mo.net')>-1){			// 256041, mu-mo.net uses SCRIPT for..event.. syntax
		scriptForEventFix();
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (mu-mo.net uses SCRIPT for..event.. syntax). See browser.js for details');
	} else if(hostname.indexOf('n-gage.com') >-1 && navigator.userAgent.indexOf('Mac')>-1){			// 181451, N-Gage plugin sniffing does not give Flash to Mac Opera
		opera.defineMagicVariable('g_plugin', function(){return navigator.mimeTypes['application/x-shockwave-flash'].enabledPlugin},null);
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (N-Gage plugin sniffing does not give Flash to Mac Opera). See browser.js for details');
	} else if(hostname.indexOf('namooya.com')>-1){			// 241286, Namooya.com main flash does not appear
		document.attachEvent=undefined;
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Namooya.com main flash does not appear). See browser.js for details');
	} else if(hostname.indexOf('news.bbc.co.uk')!=-1){			// 356736, Disabling Opera detection that prevents the BBC Olympic Map from appearing
		opera.addEventListener('BeforeExternalScript', function(e){
			indexOf.call=replace.call=addEventListener.call=call;
			var oldUA = navigator.userAgent;
			if (indexOf.call(e.element.src, 'glow.js')!=-1){
				navigator.userAgent = replace.call(navigator.userAgent, 'Opera', '0pera (spoofing as Firefox)');
			}
			if(navigator.userAgent!=oldUA)addEventListener.call(opera,'AfterExternalScript', function(e){
				removeEventListener.call=call;
				navigator.userAgent=oldUA;
				removeEventListener.call(opera,'AfterExternalScript', arguments.callee, false);
			}, false);
		}, false);
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Disabling Opera detection that prevents the BBC Olympic Map from appearing). See browser.js for details');
	} else if(hostname.indexOf('news.msn.co.kr') >-1){			// 342895, news.msn.co.kr navigation bar is offset from the page
		addCssToDocument('#home{position:relative!important}');
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (news.msn.co.kr navigation bar is offset from the page). See browser.js for details');
	} else if(hostname.indexOf('nrg.co.il')>-1){			// 244416,  NRG.co.il saving articles does not work
		addPreprocessHandler('document.getElementById("launcher").innerHTML="";', '');
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' ( NRG.co.il saving articles does not work). See browser.js for details');
	} else if(hostname.indexOf('picasaweb.google')!=-1){			// 304172, Picasaweb browser sniffing removes functionality Opera has no problems with, for example slideshow
		var oldua=navigator.userAgent;
		navigator.userAgent = {
			toString: function(){return oldua},
			toLowerCase:function(){ return oldua.replace( /Opera./, 'MSIE ' ).toLowerCase(); },
			toUpperCase:function(){ return oldua.toUpperCase(); },
			indexOf: function(s){ return oldua.indexOf(s); }
		}
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Picasaweb browser sniffing removes functionality Opera has no problems with, for example slideshow). See browser.js for details');
	} else if(hostname.indexOf('poczta.onet.pl')>-1){			// 338246,  poczta.onet.pl RTE broken in 9.50
		opera.addEventListener('BeforeEvent.load', function(e){
			if( document.getElementById('idIframka') ){
				document.getElementById('idIframka').contentDocument.designMode='on';
			}
		}, false);
		
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' ( poczta.onet.pl RTE broken in 9.50). See browser.js for details');
	} else if(hostname.indexOf('pogo.com')>-1){			// 305697,  Java detection fails on pogo.com
		if(navigator.javaEnabled()){
			var javaVersion = java.lang.System.getProperty('java.version');
			navigator.userAgent += ' Firefox';
			javaVersion=(javaVersion+'').split( '.' ).splice(0,2).join('.');
			navigator.mimeTypes[navigator.mimeTypes.length] = {type: 'application/x-java-applet;version=' + javaVersion };
			navigator.mimeTypes.length = navigator.mimeTypes.length+1;
		}
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' ( Java detection fails on pogo.com). See browser.js for details');
	} else if(hostname.indexOf('rabobank.nl')!=-1){			// 277063,  Rabobank cancels t keypress
		opera.addEventListener('AfterEvent.keypress', function(e){
			preventDefault.call=call;
			if(e.event.keyCode==116 && e.eventCancelled)preventDefault.call(e);
		},false);
		
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' ( Rabobank cancels t keypress). See browser.js for details');
	} else if(hostname.indexOf('redfin.com')!=-1){			// DSK-231794, Solve Dojo script scheduling trouble on redfin.com
		fixJQueryScriptSchedulingTrouble();
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Solve Dojo script scheduling trouble on redfin.com). See browser.js for details');
	} else if(hostname.indexOf('reviews.cnet.com') >-1){			// 179484, CNet videos: document.write adds a script that depends on variables defined later
		opera.addEventListener('BeforeScript',
		function(ev){ 
				indexOf.call=replace.call=call;
				var js=ev.element.text, problemstr='document.write(\'<script type="text/javascript" src="\'+skin+\'"></script>\');';
				if(indexOf.call(js, problemstr ) > -1 ){
					ev.element.text = replace.call(ev.element.text,  problemstr,'' )+';\n'+problemstr;
			}
		}
		,false);
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (CNet videos: document.write adds a script that depends on variables defined later). See browser.js for details');
	} else if(hostname.indexOf('santandertotta.pt')!=-1){			// 260929, Santandertotta.pt IFRAME resize script detects Opera
		fixIFrameSSIscriptII('startdyncode', 'ws');
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Santandertotta.pt IFRAME resize script detects Opera). See browser.js for details');
	} else if(hostname.indexOf('sfile.ydy.com')!= -1){			// 361539, Avoid manipulating broken Discuz! markup on sfile.ydy.com
		opera.defineMagicFunction('announcementScroll', function(){});
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Avoid manipulating broken Discuz! markup on sfile.ydy.com). See browser.js for details');
	} else if(hostname.indexOf('show.co.kr')!=-1){			// 348818, Pre-filled text as INPUT background not cleared on focus
		document.addEventListener('focus', function(e){if(e.target.tagName=='INPUT'){e.target.style.backgroundImage='none'; e.target.onfocus=null;}},true);
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Pre-filled text as INPUT background not cleared on focus). See browser.js for details');
	} else if(hostname.indexOf('spaces.live.com')!=-1){			// 311225, Overriding spaces.live.com browser sniffing
		opera.addEventListener(
			'BeforeScript',
			function(){ window.opera=undefined; },
			false
		);
		
		opera.addEventListener(
			'AfterScript',
			function(e){
				var ok=false;
				if( typeof attachOperaCompatibility == 'function' ){
					attachOperaCompatibility(window);
					ok=true;
				}else if( typeof $Browser !='undefined' && typeof $Browser.attachOperaCompatibility == 'function' ){
					$Browser.attachOperaCompatibility(window);
				}
				if(ok){
					opera.removeEventListener( 'AfterScript', arguments.callee, false );
					
				}
			},
			false
		);
		
				// 311225, Make Range.prototype.insertNode automatically import nodes from other documents
		var rangeInsertNode = Range.prototype.insertNode;
		Range.prototype.insertNode = function(n){
			if(this.startContainer && this.startContainer.ownerDocument && n.ownerDocument != this.startContainer.ownerDocument )n=this.startContainer.ownerDocument.importNode(n, true);
			return rangeInsertNode.call(this,n);
		}
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Overriding spaces.live.com browser sniffing\nMake Range.prototype.insertNode automatically import no...). See browser.js for details');
	} else if(hostname.indexOf('spreadsheets')==0&&hostname.indexOf('.google.')>-1){			// 215770, Faking support for event object properties layerX and layerY
		opera.addEventListener( 'BeforeEventListener', function( e ){
			if(e.event.offsetX){
				e.event.layerX=e.event.offsetX;
				e.event.layerY=e.event.offsetY;
			}
		}, false );
		
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Faking support for event object properties layerX and layerY). See browser.js for details');
	} else if(hostname.indexOf('synaptics.com')>-1||href.indexOf('shareholder.com/synaptics')>-1){			// 191364, Synaptics.com outdated HVMenu
		fixHVMenu('var.js');
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Synaptics.com outdated HVMenu). See browser.js for details');
	} else if(hostname.indexOf('sytadin.fr')!=-1){			// 365351, Sytadin.fr IFRAME resize script detects Opera
		fixIFrameSSIscriptII('resizeIframeOnContent');
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Sytadin.fr IFRAME resize script detects Opera). See browser.js for details');
	} else if(hostname.indexOf('tdwaterhouse.ca')>-1&&location.protocol=='https:'){			// 147840, tdwaterhouse.ca login fails - cross-domain access on https disallows setting location
		document.domain='tdwaterhouse.ca';
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (tdwaterhouse.ca login fails - cross-domain access on https disallows setting location). See browser.js for details');
	} else if(hostname.indexOf('teletekst.nos.nl')>-1){			// 126136, Teletext focus fix
		window.focus = function () {event.preventDefault();};
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Teletext focus fix). See browser.js for details');
	} else if(hostname.indexOf('tiscali.it')!=-1){			// 344935, Allows some frame nesting on web.tiscali.it
		opera.defineMagicVariable('address', function(current) {
		if (window == window.top && current == window.location) {
		    return (current.search) ? current.href + '&' : current.href+'?';
		}
		return current;
		}, null);
		
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Allows some frame nesting on web.tiscali.it). See browser.js for details');
	} else if(hostname.indexOf('tistory.com')!=-1){			// 347990, two login buttons on tistory.com
		addCssToDocument('#memberbox .btn-login {text-indent:-100px;}');
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (two login buttons on tistory.com). See browser.js for details');
	} else if(hostname.indexOf('united.com')>-1 || hostname.indexOf('flyted.com')>-1 || hostname.indexOf('itn.net')>-1){			// 193907,  United.com flight search problem: hidden images do not load, so no onload event
				document.addEventListener('load', function(){
					var i,img;
					var isHidden = function(el){
						if(!el){ return false;}
						var elmIsHidden=((el.style && el.style.display=='none') || window.getComputedStyle(el).display=='none');
						return (elmIsHidden || isHidden( el.parentNode ));
					}
					for(i=document.images.length-1;img=document.images[i];i--){
						if(img.onload){
							if( isHidden( img ) ){
								img.onload();
								return;
							}
						}
					}
				}, false);	
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' ( United.com flight search problem: hidden images do not load, so no onload event). See browser.js for details');
	} else if(hostname.indexOf('usairways.com')>-1){			// 0,  USAirways is not compatible with WF2 spec required attribute
		opera.addEventListener('BeforeEvent.invalid', function(e){
			/* they specify required="True" attributes on hidden form elements. This tries to check if they are hidden
			and make sure they are temporarily "un-required" if they are */
			getAttribute.call = getComputedStyle.call = removeAttribute.call = setTimeout.call = preventDefault.call = call;
			var el=e.event.target;
			if( getAttribute.call(el, 'required')=='True' && getComputedStyle.call(window, el).visibility=='hidden' ){
				removeAttribute.call(el,'required');
				setTimeout.call(window, function(){setAttribute.call=call; setAttribute.call(el,'required', 'True');},0 )
				preventDefault.call(e.event);
			}
		}, false);
		
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' ( USAirways is not compatible with WF2 spec required attribute). See browser.js for details');
	} else if(hostname.indexOf('video.nbc.com')>-1||href.indexOf('nbc.com/Video')>-1){			// 243428, NBC.com video problems
		document['all']=null;
		addCssToDocument('#flashcontent{height:550px!important}');
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (NBC.com video problems). See browser.js for details');
	} else if(hostname.indexOf('walla.co.il')!=-1){			// 184398,  Walla.co.il odd CSS styling causes display problems. Bugs 184398, 184399, 206793
		addCssToDocument(' .btn-t,.btn-r, .btn{display:inline !important;} .wp-0-b{width:auto !important}table {table-layout: auto !important}.w2b + table { width: 100%;}');
		
				// 327825, New mail UI on Walla requires IE-style event capture
		emulateIECapturingEvents();
				// 209477, walla.co.il custom videoplayer does not work
		opera.defineMagicFunction( 'showPlayerObject', function( origfunc, origthis, id, url ){
			document.getElementById(id).innerHTML='<object type="video/x-ms-asf" data="'+url+'"  width="100%" height="282" autostart="true"> failed to render object </object>';
			
		});
		document.addEventListener('load', function(){
			var play=document.getElementById('td_play');if(play && play.tagName=='TD'){play.parentNode.parentNode.parentNode.parentNode.style.display='none';}
		}, false);
		
				// 205887, Walla workaround for white-space issue
		addCssToDocument('button.w2 {white-space: nowrap;}');
		
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' ( Walla.co.il odd CSS styling causes display problems. Bugs 184398, 184399, 206793\nNew mail UI on Wa...). See browser.js for details');
	} else if(hostname.indexOf('walmart.com')!=-1){			// 279084, Walmart hides "find in store" popup unintentionally
		addCssToDocument('#overlay{display: block!important}');
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Walmart hides "find in store" popup unintentionally). See browser.js for details');
	} else if(hostname.indexOf('westjet.com')>-1 ){			// 270752,  Westjet browser sniffing causes reload loop
		opera.defineMagicVariable('browser', function(o){ o.isSupported=true; return o; }, null);
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' ( Westjet browser sniffing causes reload loop). See browser.js for details');
	} else if(hostname.indexOf('worldofwarcraft.com')>-1){			// 237552, Mouseover popups do not appear due to document.all sniffing
		document.all=null;
		fakeOncontextmenu(true, 500);
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (Mouseover popups do not appear due to document.all sniffing). See browser.js for details');
	} else if(hostname.indexOf('ynet.co.il')>-1||hostname.indexOf('ynetnews.com')>-1){			// 224708, YNet article comments display fix
		addCssToDocument('table {display:table !important}');
		
		opera.defineMagicFunction( 'showTb', function( oFunc, oThis, tbId,isShow ){ 
					oFunc.apply(oThis, arguments.slice(2));
					oTitle.style.display= '';
					oTitle.style.display= ( isShow ) ? 'none !important': '';
					oText.style.display= '';
					oText.style.display= ( isShow ) ? '' : 'none !important' ;
				} );
		opera.defineMagicFunction( 'loadTbData', function(oFunc, oThis, tbld, tbDataText){
					var i1=tbDataText.indexOf('window.open('); 
					var i2=tbDataText.indexOf(')', i1); 
					var probl=tbDataText.substring(i1, i2);
					probl=probl.replace(/\"/g, '&quot;');
					tbDataText=tbDataText.substring(0, i1 )+probl+tbDataText.substring(i2); 
					oFunc.call(oThis, tbld, tbDataText);
				} );	
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (YNet article comments display fix). See browser.js for details');
	} else if(hostname.indexOf('zdnet.com.com')>-1 ){			// 146580, ZDnet video site plays non-existing files if browser is Opera
		navigator.userAgent=navigator.userAgent.replace(/Opera/, 'MSIE 6.0');	
			if(self==top)postError.call(opera, 'Opera has modified the JavaScript on '+hostname+' (ZDnet video site plays non-existing files if browser is Opera). See browser.js for details');
	}
})(opera);
